[general]
name=pyArchInit
qgisMinimumVersion=3.22
qgisMaximumVersion=4.99
supportsQt6=True
description=pyArchInit - Complete Archaeological Data Management System for excavations, stratigraphy, finds, GIS mapping and scientific reporting

version=5.0.4-alpha

author=Luca Mandolesi & Enzo Cocca
email=pyarchinit@gmail.com

about=pyArchInit is a comprehensive open-source plugin for archaeological data management within QGIS.
    It provides tools for managing excavation data, stratigraphic units (US/USM), finds inventory,
    tombs, periodization, and site documentation. Key features include:
    - Stratigraphic unit management with Harris Matrix generation
    - Archaeological finds and pottery inventory
    - Anthropological and zooarchaeological records
    - PDF report generation (Italian MiBACT standards)
    - Image and media management with tagging
    - PostgreSQL/PostGIS and SQLite/Spatialite database support
    - AI-powered report generation and data analysis
    - Multi-language support (IT, EN, DE, ES, FR, AR)

    Developed by pyArchInit community.
    Documentation: https://pyarchinit.github.io
    GitHub: https://github.com/pyarchinit/pyarchinit


tracker=https://github.com/pyarchinit/pyarchinit/issues
repository=https://github.com/pyarchinit/pyarchinit


changelog=5.0.4-alpha (2026-02-09) [Tutorial Viewer]:
    - Feature: embed HTML5 animation playback inside Tutorial Viewer using QStackedWidget (QTextBrowser for markdown + QWebEngineView for animations)
    - Feature: multi-path QWebEngineView import (qgis.PyQt, PyQt5, PyQt6) for broader compatibility
    - Feature: back button to return from animation to tutorial content
    - Feature: graceful degradation to system browser when QWebEngineView unavailable
    - Refactor: remove custom QWebEnginePage subclasses (TutorialWebEnginePage, DockTutorialWebPage)
    - Refactor: DockWidget tutorial tab uses same QStackedWidget architecture
  5.0.3-alpha (2026-02-09) [UI & Branding]:
    - Feature: redesign splash screen with futuristic deep-space animation (particles, orbital rings, energy nodes, scanning grid)
    - Feature: add typewriter effect and blinking cursor for status messages
    - Feature: add CNR-ISPC and Horizon StratiGraph partner logos to splash screen
    - Feature: add animated corner accents and edge data ticks
    - Docs: update README with StratiGraph / Horizon Europe integration details
    - Docs: update project structure with modules/stratigraph/ tree
    - Docs: add CNR-ISPC, 3DR, ARC partner acknowledgments
  5.0.2-alpha (2026-02-08) [StratiGraph Phase 2 / Horizon Europe]:
    - Feature: add offline-first sync state machine with 6 states and QgsSettings persistence
    - Feature: add persistent sync queue backed by dedicated SQLite database
    - Feature: add connectivity monitor with configurable health check and debounce
    - Feature: add sync orchestrator with automatic queue processing and exponential backoff retry
    - Feature: add StratiGraph Sync dock widget panel with status indicators and activity log
    - Feature: add queue management dialog for inspecting sync entries
    - Feature: add StratiGraph Sync toolbar button with dedicated icon
    - Docs: add StratiGraph Sync tutorial in 7 languages (it, en, de, es, fr, ar, ca)
  5.0.1-alpha (2026-02-08) [StratiGraph Phase 1 / Horizon Europe]:
    - Feature: add entity_uuid (UUID v4) persistent identifiers to all 19 data tables
    - Feature: auto-generate UUID for new records on insert (PostgreSQL and SQLite)
    - Feature: auto-migrate existing databases to add entity_uuid column at startup
    - Feature: add StratiGraph bundle system (creator, manifest, validator)
    - Feature: add UUID manager for generation, validation, and URI construction
    - Feature: add bundle manifest with 6 mandatory BMD metadata fields
    - Feature: add bundle validator for pre-export integrity checks
    - Feature: add database migration script for UUID support
    - Docs: add STRATIGRAPH_INTEGRATION.md reference document
  4.9.76 (2026-01-29):
    - Feature:  apply nested US symbology in multiple layer loading functions
    - Feature:  apply nested US symbology when loading US/USM views
    - Feature:  add nested rule-based symbology for US layers
    - Fix:  remove stratigraph_index_us from ORDER BY in views
    - Feature:  fix geometry button now also rebuilds tables to fix column types
    - Feature:  add rebuild geometry tables and use QGIS fix geometries
    - Fix:  add debug output for SpatiaLite loading and pyspatialite fallback
    - Fix:  correct SpatiaLite extension paths for QGIS on macOS
    - Fix:  improve geometry repair with proper SpatiaLite/PostGIS handling
    - Fix:  fix geometry repair and reorganize UI buttons
  4.9.75 (2026-01-29):
    - Chore:  add gis logs to gitignore
  4.9.74 (2026-01-29):
    - Fix:  sort legend rules by order_layer in US view styling
    - Fix:  add ORDER BY to US views for correct stratigraphic ordering
  4.9.73 (2026-01-29):
    - Fix:  use OGR provider for SpatiaLite views to avoid schema caching bug
  4.9.72 (2026-01-28):
    - Fix:  remove hardcoded white backgrounds for dark theme compatibility
    - Feature:  add rock architecture (AR) fields to strutture view
    - Feature:  add stratigraphic layer ordering and multilingual style field selection
    - Fix:  order layer now recognizes relationships in ALL languages
    - Feature:  add manual database schema update button and menu action
  4.9.71 (2026-01-27):
    - Feature:  display taxonomic data as tables in Fauna PDF
    - Fix:  add empty DATA_LIST check in Fauna update_if
    - Fix:  change Numero Stimato Resti from lineEdit to comboBox
    - Feature:  add fauna thesaurus codes 13.14-13.16 with 7-language support
    - Fix:  resolve Fauna PDF and thesaurus issues
  4.9.70 (2026-01-24):
    - Fix:  resolve duplicate 'lang' keyword argument in PDF canvas
    - Feature:  comprehensive UT form update with GNA export and analysis
  4.9.69 (2026-01-24):
    - Docs:  update UT tutorials for DE, ES, FR, CA languages
    - Feature:  add def_ut thesaurus (12.7) and update UT tutorials
    - Fix:  correct Arabic language code in UT thesaurus from ar_AR to ar_LB
    - Feature:  add UT thesaurus entries for all 7 supported languages
    - Feature:  enhance UT analysis PDF and add Struttura PDF translations
  4.9.68 (2026-01-24):
    - Chore:  add migration and test scripts
  4.9.67 (2026-01-24):
    - Fix:  resolve UT heatmap generation and form loading errors
    - Feature:  add UT archaeological potential and risk analysis module
  4.9.66 (2026-01-23):
    - Fix:  thesaurus nome_tabella bug and add Struttura PDF translations
    - Fix:  resolve Fauna form update and navigation issues
    - Fix:  resolve Fauna form SQLite errors and thesaurus issues
  4.9.65 (2026-01-23):
    - Feature:  add PDF export for Struttura form with improved layout
  4.9.64 (2026-01-23):
    - Miglioramenti e correzioni varie
  4.9.63 (2026-01-23):
    - Fix:  correct thesaurus language format in Fauna form
  4.9.62 (2026-01-23):
    - Feature:  implement natural sorting for US field
    - Fix:  add order_layer mapping to CONVERSION_DICT for sorting
    - Docs:  add Structure field and Order Layer documentation in de/fr/es/ar/ca
    - Docs:  add Structure field and Order Layer documentation
    - Feature: i18n: complete translations for Fauna, Struttura and other forms
  4.9.61 (2026-01-23):
    - Feature: fauna: redesign PDF sheet with professional full-page layout
  4.9.60 (2026-01-22):
    - Fix:  convert empty nr_cassa to None for PostgreSQL bigint field
    - Fix:  revert lineEdit_materiale changes, keep only inventario sync
    - Fix:  sync TMA inventario/materiale fields with inventario_materiali table
    - Fix:  make PyPDF2 import optional in tma_import_parser
    - Fix:  add missing setTableEnable method to Inv_Materiali
    - Feature:  add theme toggle button to all forms
    - Feature:  apply theme to configuration dialog
  4.9.59 (2026-01-22):
    - Fix:  prevent double row insertion in TMA foto/disegno tables
  4.9.58 (2026-01-22):
    - Feature:  add centralized theme manager with dark/light mode support
    - Fix:  add missing session.commit() in DB_MANAGER.update() method
    - Feature: struttura: add Rock-cut Architecture (AR) fields and multilingual thesaurus
  4.9.57 (2026-01-22):
    - Fix:  optimize media loading with local/remote detection and PyQt5/PyQt6 compatibility
  4.9.56 (2026-01-21):
    - Fix:  install packages to QGIS site-packages with --target
    - Fix:  check only package name, not version (avoids duplicate version issues)
    - Fix:  install to QGIS site-packages first, --user as fallback
  4.9.55 (2026-01-21):
    - Fix:  check package versions, not just names, for updates
    - Chore:  update google packages to latest versions
    - Fix:  use sys.prefix instead of sys.executable for macOS pip
  4.9.54 (2026-01-21):
    - Fix:  improve macOS package installation reliability
    - Fix:  resolve macOS spatialite and google-auth installation issues
  4.9.53 (2026-01-21):
    - Miglioramenti e correzioni varie
  4.9.52 (2026-01-20):
    - Fix:  repair broken code structure after debug removal
    - Fix:  repair broken code structure in imageViewer.py
    - perf: remove debug prints from forms and utilities
    - perf: remove debug prints from remote image loading
  4.9.51 (2026-01-20):
    - Feature:  add UNIBO file upload support for drag&drop media
    - Feature:  add UNIBO File Manager storage backend integration
    - Feature:  add initial implementation of unibo file manager backend and storage tests
  4.9.50 (2026-01-16):
    - Feature:  use form icons in workflow tabs and fix tutorial images
    - Feature:  add interactive workflow tabs with clickable buttons
    - Fix:  remove overlapping workflow diagrams from existing tabs
    - Fix:  handle QGridLayout in workflow diagram insertion
    - Feature:  complete tutorial list, fix text colors, add workflow diagrams
    - Feature:  embed tutorial viewer and modern UI in dock widget
    - Feature:  enhance PyArchInit dock widget with web views and tooltips
  4.9.49 (2026-01-16):
    - Feature:  add multilingual thesaurus code documentation
  4.9.48 (2026-01-15):
    - Feature:  add multilingual tutorial documentation
    - Feature:  add Tutorial Viewer with multilingual support
  4.9.47 (2026-01-14):
    - Miglioramenti e correzioni varie
  4.9.46 (2026-01-14):
    - Fix:  load thesaurus URL in internal webView_adarte widget instead of external browser
  4.9.45 (2026-01-13):
    - Fix:  ensure record counter updates after insert/update/delete
    - Fix:  use correct button name pushButton_view_all_2 in Inv_Materiali
    - Fix:  add enable_button method to Inv_Materiali and recreate Session factory after insert
  4.9.44 (2026-01-13):
    - Fix:  centralize connection pool refresh in insert_data_session
    - Fix:  force connection pool refresh after insert in Struttura form
    - Fix:  add expire_all to query_sort for fresh data after insert
    - Fix:  expire session cache before query to get fresh data after delete
    - Fix:  ensure proper type casting and fresh metadata in delete_one_record
    - Fix:  update delete_one_record for SQLAlchemy 2.0 compatibility
    - Fix:  add missing record comparison methods to Struttura form
    - Fix:  add missing table2dict and tableInsertData methods to Struttura
    - Fix:  handle boolean values in setComboBoxEnable for Struttura form
    - Fix:  add missing empty_fields_nosite method to Struttura form
  4.9.43 (2026-01-13):
    - Fix: ui: adjust window and widget dimensions in Inv_Materiali.ui
  4.9.42 (2026-01-12):
    - perf: prevent duplicate database checks during QGIS session
  4.9.41 (2026-01-12):
    - Fix:  drop view before recreating to allow column name changes
    - Fix:  PostgreSQL updater _execute_sql parameter and trigger execution
  4.9.40 (2026-01-12):
    - perf: add database performance indexes and DEBUG flag for print control
  4.9.39 (2026-01-11):
    - Chore:  pin all dependencies to exact latest versions
  4.9.38 (2026-01-11):
    - Fix:  add --upgrade to pip install for exact version packages
  4.9.37 (2026-01-11):
    - Chore:  update opencv-python to 4.12.0.88
    - Fix:  robust folder installation with error handling
  4.9.36 (2026-01-11):
    - Fix:  SQLAlchemy 2.0 compatibility for db_createdump.py
  4.9.35 (2026-01-11):
    - Chore: deps: pin opencv-python to version 4.10.0.84 in requirements.txt
  4.9.34 (2026-01-11):
    - Miglioramenti e correzioni varie
  4.9.33 (2026-01-11):
    - Miglioramenti e correzioni varie
  4.9.32 (2026-01-11):
    - Fix:  pin numpy to exact version 1.26.4 for QGIS compatibility
    - Fix:  pin numpy<2.0 to prevent QGIS compatibility issues
  4.9.31 (2026-01-11):
    - Fix:  make opencv optional to avoid Windows installation issues
  4.9.30 (2026-01-11):
    - Fix:  correct package versions in requirements.txt for Windows compatibility
  4.9.29 (2026-01-11):
    - Docs:  update changelog with detailed descriptions from 4.9.6 to 4.9.28
    - Docs:  add GitHub development repository URL to README
  4.9.28 (2026-01-09):
    - Fix: handle duplicate column errors in all supported languages
    - Fix: SQLAlchemy 2.0 compatibility for database schema updates
  4.9.27 (2026-01-09):
    - Fix: handle duplicate column errors in database update
    - Fix: remove shlex_quote from subprocess calls
  4.9.26 (2026-01-09):
    - Fix: remove debug prints and improve Windows QGIS detection
    - Fix: splash screen no longer blocks package installation dialog
  4.9.25 (2026-01-09):
    - Chore: comment out unused pyper dependency in requirements.txt
  4.9.24 (2026-01-08):
    - Fix: add missing tableInsertData method and ast import to Inv_Materiali
    - Fix: restore original loadMediaPreview with mode parameter
    - Fix: simplify Inv_Materiali loadMediaPreview to match Pottery
  4.9.23 (2026-01-07):
    - Feat: add new pyarchinit_splash.py file for splash screen functionality
    - Fix: update Pottery UI palette in Qt Designer for Qt6 compatibility
    - Fix: ensure labels are readable in Qt6 for Pottery form
  4.9.22 (2025-12-28):
    - Fix: restore missing methods and fix integer fields in Inv_Materiali.py
    - Fix: convert empty strings to NULL for numeric columns in SQLite sync
    - Feat: add comprehensive translations for all 7 languages
    - Feat: add missing translations for UI forms (7 languages)
    - Feat: add concurrency columns and missing tables to SQLite template
    - Fix: sync between PostgreSQL and SQLite with different columns
    - Fix: find mod_spatialite in QGIS internal paths on macOS
    - Feat: add SQLite support to database synchronization
    - Feat: add connection profiles to DB Settings tab
  4.9.21 (2025-12-28):
    - Feat: enhance splash screen with larger gears and update metadata
    - Feat: update splash screen with Archeoimagineers logo and pyArchInit 5 title
    - Feat: show splash screen during plugin load/reload
    - Feat: add animated splash screen for package installation
    - Feat: update toolbar icons with modern colorful design
  4.9.20 (2025-12-28):
    - Feat: Add UT geometry tables, Fauna search, and Thesaurus support
    - Feat: add Fauna tab and move UT to non-experimental features
    - Fix: convert remaining Qt6 scoped enum patterns
    - Fix: convert all Qt6-style enum syntax to PyQt5-compatible format
    - Fix: restore missing methods and fix form loading for Qt6 migration
    - Feat: Qt6/PyQt6 migration and major refactoring (v5.0)
  4.9.15 (2025-12-18):
    - Feat: Image Search - dedicated dialog for global image search
    - Feat: Image Search - search by text, entity type, site, area, US
    - Feat: Image Search - navigate directly to associated records (goto_record)
    - Feat: Image Search - export functionality for images
    - Feat: ImageViewer - export button for saving displayed images
    - Fix: database connection using singleton pattern
    - Fix: image path construction using thumb_resize + path_resize
    - Docs: add changelog for feature/cloudinary-integration branch
  4.9.14 (2025-12-14):
    - Feat: SAM stone segmentation tool with local and cloud API support
    - Feat: SAM - interactive click and box modes for segmentation
    - Feat: Pottery - KhutmML-CLIP fine-tuning and similarity search
    - Feat: Pottery - auto-rebuild indexes after training
    - Feat: Pottery - model export/import and tips
  4.9.13 (2025-12-14):
    - Feat: database - add automatic GRANT sync when tables are recreated
    - Feat: Pottery - add year filter to PotteryFilterDialog
  4.9.12 (2025-12-14):
    - Feat: Pottery - add ID Number filter dialog with checkboxes
  4.9.11 (2025-12-13):
    - Feat: Pottery - add decoration fields and fix Thesaurus bugs
    - Feat: Pottery - add decoration crosstabs and fix chart type switching
    - Feat: Pottery - enhance statistics with specific_form, new charts
  4.9.10 (2025-12-13):
    - Feat: Inventario - add filter dialog for numero_inventario, n_reperto and years
    - Feat: PDF - add photo_id and drawing_id to inventory and pottery lists
    - Fix: Inventario - use query() instead of query_all() for mapper class
  4.9.9 (2025-12-13):
    - Feat: SAM - enhance segmentation with local model support
    - Fix: SAM - fix interactive modes and make cloud API default
    - Fix: Report - process image tags BEFORE markdown formatting
    - Fix: Report - handle missing database tables gracefully
  4.9.8 (2025-12-10):
    - Feat: AI visual similarity search with Cloudinary support
    - Feat: DINOv2 support with improved decoration preprocessing
    - Feat: Import/Export indexes for sharing between PCs
    - Feat: Excel export with thumbnails and chart
  4.9.7 (2025-12-10):
    - Feat: AI Query Database - standalone toolbar button
    - Feat: AI Query - FAISS vectorstore persistent storage
    - Feat: AI Query - auto-load for all pyarchinit vector views
    - Feat: US_USM - auto-sync ref_ra/ref_n with inventory and pottery
  4.9.6 (2025-12-10):
    - Feat: Cloudinary CDN integration with AI features
    - Feat: Remote storage support for thumbnails and images
    - Feat: Pottery - visual similarity search with multi-image support
    - Feat: UI - update icons and modern colorful design
  4.9.5 Fix Windows plugin loading issues, lazy imports for OpenAI/Langchain/PyMuPDF.

tags=archaeology, analysis, database, digitizing, postgres, postgis, spatialite, sqlite, archeologia, funerary archaeology, pottery, bones, excavations, scavi, archeologici, siti, carte, archeologiche, carta di potenzialita, strutture, antiche, tempio, medioevo, romana, preistoria, roman, medieval, prehistoric

homepage=https://www.adarteinfo.it
category=Plugins
icon=resources/icons/logo_pyarchinit.png
experimental=False
deprecated=False