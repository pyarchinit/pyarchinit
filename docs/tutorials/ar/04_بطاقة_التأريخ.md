# دليل 04: بطاقة التأريخ

## الفهرس
1. [المقدمة](#المقدمة)
2. [الوصول إلى البطاقة](#الوصول-إلى-البطاقة)
3. [واجهة المستخدم](#واجهة-المستخدم)
4. [المفاهيم الأساسية](#المفاهيم-الأساسية)
5. [حقول البطاقة](#حقول-البطاقة)
6. [شريط أدوات DBMS](#شريط-أدوات-dbms)
7. [وظائف GIS](#وظائف-gis)
8. [تصدير PDF](#تصدير-pdf)
9. [تكامل الذكاء الاصطناعي](#تكامل-الذكاء-الاصطناعي)
10. [سير العمل التشغيلي](#سير-العمل-التشغيلي)
11. [أفضل الممارسات](#أفضل-الممارسات)
12. [حل المشكلات](#حل-المشكلات)

---

## المقدمة

**بطاقة التأريخ** أداة أساسية لإدارة المراحل الزمنية للحفريات الأثرية. تسمح بتحديد الفترات والمراحل التي تميز التسلسل الطبقي للموقع، وربط كل زوج من الفترة/المرحلة بتأريخ زمني ووصف.

### الغرض من البطاقة

- تحديد التسلسل الزمني للحفر
- ربط الفترات والمراحل بالوحدات الطبقية
- إدارة التأريخ المطلق (السنوات) والنسبي (الفترات التاريخية)
- عرض الوحدات الطبقية حسب الفترة/المرحلة على خريطة GIS
- إنشاء تقارير PDF للتأريخ

### العلاقة مع البطاقات الأخرى

ترتبط بطاقة التأريخ ارتباطاً وثيقاً بـ:
- **بطاقة الوحدة الطبقية US/USM**: يتم تعيين كل وحدة طبقية لفترة ومرحلة
- **بطاقة الموقع**: الفترات خاصة بكل موقع
- **مصفوفة هاريس**: الفترات تلون المصفوفة حسب المرحلة الزمنية

---

## الوصول إلى البطاقة

### من القائمة

1. افتح QGIS مع تفعيل إضافة PyArchInit
2. قائمة **PyArchInit** ← **Archaeological record management** ← **Excavation - Loss of use calculation** ← **Period and Phase**

### من شريط الأدوات

1. حدد شريط أدوات PyArchInit
2. انقر على أيقونة **التأريخ** (أيقونة موقع مع ساعة)

---

## واجهة المستخدم

واجهة بطاقة التأريخ منظمة بطريقة بسيطة وخطية:

### المناطق الرئيسية

| المنطقة | الوصف |
|---------|--------|
| **1. شريط أدوات DBMS** | شريط أدوات للتنقل وإدارة السجلات |
| **2. مؤشرات الحالة** | معلومات قاعدة البيانات، الحالة، الترتيب |
| **3. البيانات التعريفية** | الموقع، الفترة، المرحلة، رمز الفترة |
| **4. البيانات الوصفية** | وصف نصي للفترة |
| **5. التأريخ** | السنة الأولية والنهائية |
| **6. التأريخ الموسع** | اختيار من مفردات العصور التاريخية |

---

## المفاهيم الأساسية

### الفترة والمرحلة

يعتمد نظام التأريخ في PyArchInit على هيكل هرمي من مستويين:

#### الفترة
تمثل **الفترة** مرحلة زمنية كبرى للحفر. يتم تحديدها برقم صحيح (1، 2، 3، ...) وتمثل التقسيمات الكبرى للتسلسل الطبقي.

أمثلة للفترات:
- الفترة 1: العصر المعاصر
- الفترة 2: العصر الوسيط
- الفترة 3: العصر الروماني الإمبراطوري
- الفترة 4: العصر الروماني الجمهوري

#### المرحلة
تمثل **المرحلة** تقسيماً داخلياً للفترة. يتم تحديدها أيضاً برقم صحيح وتسمح بتفصيل التسلسل بشكل أكبر.

أمثلة للمراحل في الفترة 3 (العصر الروماني الإمبراطوري):
- المرحلة 1: القرن الثالث-الرابع ميلادي
- المرحلة 2: القرن الثاني ميلادي
- المرحلة 3: القرن الأول ميلادي

### رمز الفترة

**رمز الفترة** هو معرف رقمي فريد يربط زوج الفترة/المرحلة بالوحدات الطبقية. عند تعيين فترة/مرحلة لوحدة طبقية في بطاقة الوحدة الطبقية، يتم استخدام هذا الرمز.

> **مهم**: يجب أن يكون رمز الفترة فريداً لكل مجموعة موقع/فترة/مرحلة.

### المخطط المفاهيمي

```
الموقع
└── الفترة 1 (العصر المعاصر)
│   ├── المرحلة 1 → الرمز 101
│   └── المرحلة 2 → الرمز 102
├── الفترة 2 (العصر الوسيط)
│   ├── المرحلة 1 → الرمز 201
│   ├── المرحلة 2 → الرمز 202
│   └── المرحلة 3 → الرمز 203
└── الفترة 3 (العصر الروماني)
    ├── المرحلة 1 → الرمز 301
    └── المرحلة 2 → الرمز 302
```

---

## حقول البطاقة

### الحقول التعريفية

#### الموقع
- **النوع**: قائمة منسدلة (للقراءة فقط في وضع التصفح)
- **إلزامي**: نعم
- **الوصف**: اختر الموقع الأثري الذي ينتمي إليه التأريخ

#### الفترة
- **النوع**: قائمة منسدلة قابلة للتحرير
- **إلزامي**: نعم
- **القيم**: أعداد صحيحة من 1 إلى 15 (محددة مسبقاً) أو قيم مخصصة
- **الوصف**: رقم الفترة الزمنية
- **ملاحظة**: الأرقام المنخفضة تشير إلى فترات أحدث، الأرقام المرتفعة تشير إلى فترات أقدم

#### المرحلة
- **النوع**: قائمة منسدلة قابلة للتحرير
- **إلزامي**: نعم
- **القيم**: أعداد صحيحة من 1 إلى 15 (محددة مسبقاً) أو قيم مخصصة
- **الوصف**: رقم المرحلة داخل الفترة

#### رمز الفترة
- **النوع**: حقل نص
- **إلزامي**: لا (لكن موصى به بشدة)
- **الوصف**: رمز رقمي فريد لتحديد زوج الفترة/المرحلة
- **اقتراح**: استخدم اتفاقية مثل `[الفترة][المرحلة]` (مثل 101، 102، 201، 301)

### الحقول الوصفية

#### الوصف
- **النوع**: حقل نص (متعدد الأسطر)
- **إلزامي**: لا
- **الوصف**: وصف نصي للفترة/المرحلة
- **المحتوى المقترح**:
  - الخصائص العامة للفترة
  - الأحداث التاريخية المرتبطة
  - أنواع الهياكل/المواد المتوقعة
  - المراجع البيبليوغرافية

### الحقول الزمنية

#### التأريخ الأولي
- **النوع**: حقل نص (رقمي)
- **إلزامي**: لا
- **الصيغة**: سنة رقمية
- **ملاحظات**:
  - القيم الموجبة = ميلادي
  - القيم السالبة = قبل الميلاد
  - مثال: `-100` لـ 100 ق.م، `200` لـ 200 م

#### التأريخ النهائي
- **النوع**: حقل نص (رقمي)
- **إلزامي**: لا
- **الصيغة**: سنة رقمية (نفس اتفاقيات التأريخ الأولي)

#### التأريخ الموسع (العصور التاريخية)
- **النوع**: قائمة منسدلة قابلة للتحرير مع مفردات محملة مسبقاً
- **إلزامي**: لا
- **الوصف**: اختيار من مفردات العصور التاريخية المحددة مسبقاً
- **الوظيفة التلقائية**: عند اختيار عصر، يتم ملء حقلي التأريخ الأولي والنهائي تلقائياً

### مفردات العصور التاريخية

تتضمن المفردات مجموعة واسعة من الفترات التاريخية:

| الفئة | أمثلة |
|-------|-------|
| **العصر المعاصر** | القرن 21، القرن 20 |
| **العصر الحديث** | القرن 19-16 |
| **العصر الوسيط** | القرن 15-8 |
| **العصر القديم** | القرن 7-1 |
| **الإمبراطورية الرومانية** | فترات محددة |
| **الإمبراطورية البيزنطية** | فترات محددة |
| **ما قبل التاريخ** | العصر الحجري القديم، الحجري الوسيط، الحجري الحديث، البرونزي، الحديدي |
| **العصور الإسلامية** | الأموي، العباسي، الفاطمي، المملوكي، العثماني |
| **العصور المصرية** | الدولة القديمة، الوسطى، الحديثة، المتأخرة، البطلمية |

---

## شريط أدوات DBMS

يتيح شريط أدوات DBMS إدارة السجلات بالكامل:

### أزرار التنقل

| الأيقونة | الاسم | الوظيفة |
|----------|------|---------|
| |< | First | الانتقال إلى السجل الأول |
| < | Prev | الانتقال إلى السجل السابق |
| > | Next | الانتقال إلى السجل التالي |
| >| | Last | الانتقال إلى السجل الأخير |

### أزرار إدارة السجلات

| الاسم | الوظيفة |
|------|---------|
| New record | إنشاء سجل جديد |
| Save | حفظ التعديلات |
| Delete | حذف السجل الحالي |
| View all | عرض جميع السجلات |

### أزرار البحث

| الاسم | الوظيفة |
|------|---------|
| New search | تفعيل وضع البحث |
| Search!!! | تنفيذ البحث |
| Order by | ترتيب السجلات |

### مؤشرات الحالة

| المؤشر | الوصف |
|--------|--------|
| **الحالة** | الوضع الحالي: "استخدام" (تصفح)، "بحث" (بحث)، "سجل جديد" |
| **الترتيب** | "غير مرتب" أو "مرتب" |
| **سجل رقم** | رقم السجل الحالي |
| **إجمالي السجلات** | العدد الإجمالي للسجلات |

---

## وظائف GIS

تقدم بطاقة التأريخ وظائف GIS قوية لعرض الوحدات الطبقية المرتبطة بكل فترة/مرحلة.

### أزرار GIS

#### عرض فترة واحدة (أيقونة GIS)
- **الوظيفة**: تحميل جميع الوحدات الطبقية المرتبطة بالفترة/المرحلة الحالية على خريطة QGIS
- **المتطلب**: يجب ملء حقل رمز الفترة
- **الطبقات المحملة**: US وUSM مفلترة حسب رمز الفترة

#### عرض جميع الفترات - US (أيقونة طبقات متعددة)
- **الوظيفة**: تحميل جميع الفترات كطبقات منفصلة على الخريطة (US فقط)
- **النتيجة**: طبقة لكل مجموعة فترة/مرحلة

#### عرض جميع الفترات - USM (أيقونة GIS3)
- **الوظيفة**: تحميل جميع الفترات كطبقات منفصلة على الخريطة (USM فقط)
- **النتيجة**: طبقة لكل مجموعة فترة/مرحلة للوحدات الجدارية

### العرض على الخريطة

عند تحميل الطبقات حسب الفترة:
- لكل فترة/مرحلة لون مميز
- يتم تصفية الوحدات الطبقية بناءً على رمز الفترة المعين
- يمكن تفعيل/إلغاء تفعيل الطبقات الفردية

---

## تصدير PDF

تقدم البطاقة وضعين لتصدير PDF:

### تصدير بطاقة واحدة

- **الأيقونة**: PDF
- **الوظيفة**: إنشاء PDF ببيانات الفترة/المرحلة الحالية
- **المحتوى**:
  - معلومات تعريفية (الموقع، الفترة، المرحلة)
  - التأريخ (أولي، نهائي، موسع)
  - الوصف الكامل

### تصدير قائمة التأريخ

- **الأيقونة**: ورقة/Sheet
- **الوظيفة**: إنشاء PDF بقائمة جميع الفترات/المراحل للموقع
- **المحتوى**: جدول ملخص بجميع الفترات

---

## تكامل الذكاء الاصطناعي

تتضمن بطاقة التأريخ تكاملاً مع GPT للحصول على اقتراحات تلقائية حول وصف الفترات التاريخية.

### زر الاقتراحات

### الوظيفة

1. اختر عصراً تاريخياً من حقل **التأريخ الموسع**
2. انقر على زر **الاقتراحات**
3. اختر نموذج GPT للاستخدام (gpt-4o أو gpt-4)
4. ينشئ النظام تلقائياً:
   - وصف للفترة التاريخية
   - 3 روابط ويكيبيديا ذات صلة
5. يمكن إدراج النص المُنشأ في حقل الوصف

### تكوين مفتاح API

لاستخدام هذه الوظيفة:
1. احصل على مفتاح API من OpenAI
2. عند الاستخدام الأول، يطلب النظام إدخال المفتاح
3. يتم حفظ المفتاح في `PYARCHINIT_HOME/bin/gpt_api_key.txt`

> **ملاحظة**: تتطلب هذه الوظيفة اتصالاً بالإنترنت وحساب OpenAI برصيد متاح.

---

## سير العمل التشغيلي

### إنشاء تأريخ جديد

#### الخطوة 1: الوصول إلى البطاقة
1. افتح بطاقة التأريخ من القائمة أو شريط الأدوات
2. تحقق من الاتصال بقاعدة البيانات (مؤشر الحالة)

#### الخطوة 2: سجل جديد
1. انقر على زر **New record**
2. تتغير الحالة إلى "سجل جديد"
3. تصبح الحقول قابلة للتحرير

#### الخطوة 3: اختيار الموقع
1. إذا لم يكن محدداً مسبقاً، اختر **الموقع** من القائمة المنسدلة
2. يجب أن يكون الموقع موجوداً بالفعل في بطاقة الموقع

#### الخطوة 4: تحديد الفترة والمرحلة
1. اختر أو اكتب رقم **الفترة**
2. اختر أو اكتب رقم **المرحلة**
3. أدخل **رمز الفترة** الفريد

#### الخطوة 5: التأريخ
1. اختر **التأريخ الموسع** من مفردات العصور
2. يتم ملء حقلي التأريخ الأولي والنهائي تلقائياً
3. أو أدخل السنوات يدوياً

#### الخطوة 6: الوصف
1. أكمل حقل **الوصف** بمعلومات عن الفترة
2. اختياري: استخدم زر **الاقتراحات** للحصول على نص AI

#### الخطوة 7: الحفظ
1. انقر على زر **Save**
2. يتم حفظ السجل في قاعدة البيانات
3. تعود الحالة إلى "استخدام"

### مخطط التأريخ الموصى به

لحفر نموذجية، يُنصح بإنشاء التأريخ وفقاً لهذا المخطط:

| الفترة | المرحلة | الرمز | الوصف |
|--------|---------|-------|--------|
| 1 | 1 | 101 | العصر المعاصر - طبقة الحرث |
| 1 | 2 | 102 | العصر المعاصر - الهجر |
| 2 | 1 | 201 | العصر الوسيط - المرحلة المتأخرة |
| 2 | 2 | 202 | العصر الوسيط - المرحلة الوسطى |
| 2 | 3 | 203 | العصر الوسيط - المرحلة المبكرة |
| 3 | 1 | 301 | العصر الروماني - المرحلة الإمبراطورية |
| 3 | 2 | 302 | العصر الروماني - المرحلة الجمهورية |
| 4 | 1 | 401 | ما قبل الروماني |

---

## أفضل الممارسات

### اتفاقيات الترقيم

1. **الفترات**: ترقيم من الأحدث (1) إلى الأقدم
2. **المراحل**: ترقيم من الأحدث (1) إلى الأقدم داخل الفترة
3. **الرموز**: استخدم صيغة `[الفترة * 100 + المرحلة]` للرموز الفريدة

### الأوصاف الفعالة

يجب أن يتضمن وصف الفترة الجيد:
- الإطار الزمني
- الخصائص الرئيسية للفترة
- أنواع الهياكل/المواد المتوقعة
- مقارنات مع مواقع معاصرة
- المراجع البيبليوغرافية

### إدارة التأريخ

- استخدم دائماً السنوات الرقمية للتأريخ
- للتواريخ قبل الميلاد، استخدم الأرقام السالبة
- تحقق من الاتساق: يجب أن يكون التأريخ النهائي >= الأولي

### الربط بالوحدات الطبقية

بعد إنشاء التأريخ:
1. افتح بطاقة الوحدة الطبقية
2. في تبويب **التأريخ**، عيّن الفترة الأولية/النهائية والمرحلة الأولية/النهائية
3. سيربط النظام الوحدة الطبقية بالتأريخ تلقائياً

---

## حل المشكلات

### المشكلات الشائعة

#### "Period code not add"
- **السبب**: حقل رمز الفترة فارغ
- **الحل**: أكمل حقل رمز الفترة قبل استخدام وظائف GIS

#### التأريخ لا يُملأ تلقائياً
- **السبب**: العصر المحدد ليس له بيانات مرتبطة
- **الحل**: تحقق من وجود العصر في ملف CSV للعصور التاريخية

#### خطأ في الحفظ: سجل مكرر
- **السبب**: يوجد سجل بنفس مجموعة الموقع/الفترة/المرحلة
- **الحل**: تحقق من القيم واستخدم مجموعة فريدة

#### الوحدات الطبقية لا تظهر في عرض GIS
- **السبب**: الوحدات الطبقية ليس لها رمز فترة معين
- **الحل**:
  1. تحقق في بطاقة الوحدة الطبقية من ملء حقول الفترة/المرحلة
  2. تحقق من تطابق رمز الفترة

#### اقتراحات AI لا تعمل
- **السبب**: مفتاح API مفقود أو غير صالح
- **الحل**:
  1. تحقق من الاتصال بالإنترنت
  2. تحقق من صلاحية مفتاح API
  3. أعد تثبيت المكتبات: `pip install --upgrade openai pydantic`

---

## ملخص الحقول

| الحقل | النوع | إلزامي | قاعدة البيانات |
|-------|------|--------|----------------|
| الموقع | قائمة منسدلة | نعم | sito |
| الفترة | قائمة منسدلة | نعم | periodo |
| المرحلة | قائمة منسدلة | نعم | fase |
| رمز الفترة | نص | لا | cont_per |
| الوصف | نص | لا | descrizione |
| التأريخ الأولي | نص | لا | cron_iniziale |
| التأريخ النهائي | نص | لا | cron_finale |
| التأريخ الموسع | قائمة منسدلة | لا | datazione_estesa |

---

*آخر تحديث: يناير 2026*
*PyArchInit - Sketches of Sketches*
