# الدرس 25: مدير الزمن (GIS Time Controller)

## المقدمة

**مدير الزمن** (GIS Time Controller) هو أداة متقدمة لعرض التسلسل الطبقي عبر الزمن. يتيح "التنقل" عبر المستويات الطبقية باستخدام عنصر تحكم زمني، مع عرض الوحدات الطبقية تدريجياً من الأحدث إلى الأقدم.

### الوظائف الرئيسية

- العرض التدريجي للمستويات الطبقية
- التحكم عبر قرص/شريط تمرير
- وضع تراكمي أو مستوى مفرد
- التوليد التلقائي للصور/الفيديو
- التكامل مع مصفوفة هاريس

## الوصول

### من القائمة
**PyArchInit** ← **مدير الزمن**

### المتطلبات المسبقة

- طبقة بحقل `order_layer` (الفهرس الطبقي)
- وحدات طبقية مع تعبئة order_layer
- طبقات محملة في QGIS

## الواجهة

### اللوحة الرئيسية

```
+--------------------------------------------------+
|         إدارة الزمن GIS                           |
+--------------------------------------------------+
| الطبقات المتاحة:                                  |
| [ ] pyunitastratigrafiche                        |
| [ ] pyunitastratigrafiche_usm                    |
| [ ] طبقة_أخرى                                    |
+--------------------------------------------------+
|              [قرص دائري]                         |
|                   /  \                           |
|                  /    \                          |
|                 /______\                         |
|                                                  |
|         المستوى: [مربع رقمي: 1-N]               |
+--------------------------------------------------+
| [x] الوضع التراكمي (عرض <= المستوى)             |
+--------------------------------------------------+
| [ ] عرض المصفوفة       [إيقاف] [توليد فيديو]    |
+--------------------------------------------------+
| [معاينة المصفوفة/الصورة]                         |
+--------------------------------------------------+
```

### عناصر التحكم

| العنصر | الوظيفة |
|--------|---------|
| مربع اختيار الطبقة | تحديد الطبقة للتحكم |
| القرص | التنقل بين المستويات (بالدوران) |
| المربع الرقمي | إدخال المستوى مباشرة |
| الوضع التراكمي | عرض جميع المستويات حتى المحدد |
| عرض المصفوفة | عرض مصفوفة هاريس المتزامنة |

## حقل order_layer

### ما هو order_layer؟

حقل `order_layer` يحدد ترتيب العرض الطبقي:
- **1** = المستوى الأحدث (السطحي)
- **N** = المستوى الأقدم (العميق)

### تعبئة order_layer

في بطاقة الوحدة الطبقية، حقل **"الفهرس الطبقي"**:
1. تعيين قيم متزايدة من السطح
2. الوحدات المتزامنة يمكن أن تحمل نفس القيمة
3. اتباع تسلسل المصفوفة

### مثال

| US | order_layer | الوصف |
|----|-------------|-------|
| US001 | 1 | الدبال السطحي |
| US002 | 2 | طبقة الحراثة |
| US003 | 3 | الانهيار |
| US004 | 4 | مستوى الاستخدام |
| US005 | 5 | الأساس |

## أوضاع العرض

### وضع المستوى المفرد

مربع الاختيار **غير مفعل**:
- عرض الوحدات الطبقية للمستوى المحدد فقط
- مفيد لعزل طبقات مفردة
- عرض "بالشرائح"

### الوضع التراكمي

مربع الاختيار **مفعل**:
- عرض جميع الوحدات حتى المستوى المحدد
- محاكاة الحفر التدريجي
- عرض أكثر واقعية

## تكامل المصفوفة

### العرض المتزامن

مع تفعيل مربع **"عرض المصفوفة"**:
- تظهر مصفوفة هاريس في اللوحة
- تتحدث بالتزامن مع المستوى
- تُبرز الوحدات الطبقية للمستوى الحالي

### توليد الصور

يمكن لمدير الزمن توليد:
- لقطات شاشة لكل مستوى
- تسلسل من الصور
- فيديو متسارع (time-lapse)

## توليد الفيديو/الصور

### العملية

1. تحديد الطبقات للتضمين
2. تكوين نطاق المستويات (الحد الأدنى-الأقصى)
3. النقر على **"توليد فيديو"**
4. انتظار المعالجة
5. المخرجات في المجلد المحدد

### المخرجات

- صور PNG لكل مستوى
- اختياري: فيديو MP4 مُجمع

## سير العمل النموذجي

### 1. التحضير

```
1. فتح مشروع QGIS مع طبقات US
2. التحقق من تعبئة order_layer
3. فتح مدير الزمن
```

### 2. اختيار الطبقة

```
1. تحديد الطبقات للتحكم
2. عادة: pyunitastratigrafiche و/أو _usm
```

### 3. التنقل

```
1. استخدام القرص أو المربع الرقمي
2. ملاحظة تغيير العرض
3. تفعيل/إلغاء تفعيل الوضع التراكمي
```

### 4. التوثيق

```
1. تفعيل "عرض المصفوفة"
2. توليد لقطات شاشة مهمة
3. اختياري: توليد فيديو
```

## قوالب التخطيط

### تحميل القالب

يدعم مدير الزمن قوالب QGIS لـ:
- تخطيطات طباعة مخصصة
- عناوين وأساطير
- صيغ قياسية

### القوالب المتاحة

في مجلد `resources/templates/`:
- القالب الأساسي
- قالب مع المصفوفة
- قالب للفيديو

## أفضل الممارسات

### 1. order_layer

- التعبئة قبل استخدام مدير الزمن
- استخدام قيم متتالية
- الوحدات المتزامنة = نفس القيمة

### 2. العرض

- البدء من المستوى 1 (السطحي)
- التقدم بترتيب تصاعدي
- استخدام الوضع التراكمي للعروض التقديمية

### 3. التوثيق

- التقاط لقطات شاشة عند المستويات المهمة
- توثيق انتقالات المراحل
- توليد فيديو للتقارير

## حل المشكلات

### الطبقة غير مرئية في القائمة

**السبب**: طبقة بدون حقل order_layer

**الحل**:
- إضافة حقل order_layer للطبقة
- تعبئته بقيم مناسبة

### لا تغيير مرئي

**الأسباب**:
- order_layer غير معبأ
- الفلتر غير مُطبق

**الحلول**:
- التحقق من قيم order_layer في الوحدات
- التأكد من تحديد الطبقة

### القرص لا يستجيب

**السبب**: لا توجد طبقة محددة

**الحل**: تحديد طبقة واحدة على الأقل من القائمة

## المراجع

### الملفات المصدرية
- `tabs/Gis_Time_controller.py` - الواجهة الرئيسية
- `gui/ui/Gis_Time_controller.ui` - تخطيط واجهة المستخدم

### حقل قاعدة البيانات
- `us_table.order_layer` - الفهرس الطبقي

---

## فيديو تعليمي

### مدير الزمن
`[فيديو مؤقت: video_time_manager.mp4]`

**المحتويات**:
- تكوين order_layer
- التنقل الزمني
- توليد الفيديو
- تكامل المصفوفة

**المدة المتوقعة**: 15-18 دقيقة

---

*آخر تحديث: يناير 2026*

---

## رسوم متحركة تفاعلية

استكشف الرسوم المتحركة التفاعلية لمعرفة المزيد حول هذا الموضوع.

[افتح الرسوم المتحركة التفاعلية](../../pyarchinit_timemanager_animation.html)
