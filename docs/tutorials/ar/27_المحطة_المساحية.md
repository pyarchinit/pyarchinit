# الدرس 27: TOPS - المحطة المساحية المفتوحة

## المقدمة

**TOPS** (Total Open Station) هو تكامل PyArchInit مع البرنامج مفتوح المصدر لتنزيل وتحويل البيانات من المحطات المساحية. يتيح استيراد المرفوعات الطبوغرافية مباشرة في نظام PyArchInit.

### ما هي المحطة المساحية المفتوحة؟

المحطة المساحية المفتوحة هي برنامج حر لـ:
- تنزيل البيانات من المحطات المساحية
- التحويل بين الصيغ
- التصدير إلى صيغ متوافقة مع GIS

PyArchInit يدمج TOPS لتبسيط استيراد بيانات الحفر.

## الوصول

### من القائمة
**PyArchInit** ← **TOPS (المحطة المساحية المفتوحة)**

## الواجهة

### اللوحة الرئيسية

```
+--------------------------------------------------+
|         المحطة المساحية المفتوحة إلى PyArchInit   |
+--------------------------------------------------+
| المدخلات:                                         |
|   الملف: [___________________] [استعراض]        |
|   صيغة المدخلات: [قائمة منسدلة الصيغ]           |
+--------------------------------------------------+
| المخرجات:                                         |
|   الملف: [___________________] [استعراض]        |
|   صيغة المخرجات: [csv | dxf | ...]              |
+--------------------------------------------------+
| [ ] تحويل الإحداثيات                             |
+--------------------------------------------------+
| [معاينة البيانات - عرض جدول]                     |
+--------------------------------------------------+
|              [تصدير]                              |
+--------------------------------------------------+
```

## الصيغ المدعومة

### صيغ المدخلات (المحطات المساحية)

| الصيغة | المصنع | الامتداد |
|--------|--------|----------|
| Leica GSI | Leica | .gsi |
| Topcon GTS | Topcon | .raw |
| Sokkia SDR | Sokkia | .sdr |
| Trimble DC | Trimble | .dc |
| Nikon RAW | Nikon | .raw |
| Zeiss R5 | Zeiss | .r5 |
| CSV عام | - | .csv |

### صيغ المخرجات

| الصيغة | الاستخدام |
|--------|-----------|
| CSV | استيراد في منسوب PyArchInit |
| DXF | استيراد في CAD/GIS |
| GeoJSON | استيراد GIS مباشر |
| Shapefile | معيار GIS |

## سير العمل

### 1. استيراد البيانات من المحطة المساحية

```
1. توصيل المحطة المساحية بالحاسوب
2. تنزيل ملف البيانات (الصيغة الأصلية)
3. الحفظ في مجلد العمل
```

### 2. التحويل مع TOPS

```
1. فتح TOPS في PyArchInit
2. تحديد ملف المدخلات (استعراض)
3. اختيار صيغة المدخلات الصحيحة
4. تعيين ملف المخرجات
5. اختيار صيغة المخرجات (CSV موصى به)
6. النقر على تصدير
```

### 3. الاستيراد في PyArchInit

بعد التصدير إلى CSV:
1. يطلب النظام تلقائياً:
   - **اسم الموقع** الأثري
   - **وحدة القياس** (أمتار)
   - **اسم الراسم**
2. يتم تحميل النقاط كطبقة QGIS
3. اختياري: النسخ إلى طبقة منسوب US

### 4. تحويل الإحداثيات (اختياري)

إذا كان مربع **"تحويل الإحداثيات"** مفعلاً:
- إدخال إزاحة X، Y، Z
- تطبيق انزياح الإحداثيات
- مفيد لأنظمة المرجع المحلية

## معاينة البيانات

### عرض الجدول

يُظهر معاينة البيانات المستوردة:
| point_name | area_q | x | y | z |
|------------|--------|---|---|---|
| P001 | 1000 | 100.234 | 200.456 | 10.50 |
| P002 | 1000 | 100.567 | 200.789 | 10.45 |

### تعديل البيانات

- تحديد الصفوف للحذف
- زر **حذف** يزيل الصفوف المحددة
- مفيد لتصفية النقاط غير الضرورية

## التكامل مع منسوب US

### النسخ التلقائي

بعد الاستيراد، يمكن لـ TOPS نسخ النقاط إلى طبقة **"رسم منسوب US"**:
1. يُطلب اسم الموقع
2. تُطلب وحدة القياس
3. يُطلب اسم الراسم
4. يتم نسخ النقاط مع السمات الصحيحة

### السمات المُعبأة

| السمة | القيمة |
|-------|--------|
| sito_q | اسم الموقع المُدخل |
| area_q | مُستخرج من point_name |
| unita_misu_q | الوحدة المُدخلة (أمتار) |
| disegnatore | الاسم المُدخل |
| data | التاريخ الحالي |

## اتفاقيات التسمية

### صيغة point_name

للاستخراج التلقائي للمنطقة:
```
[المنطقة]-[اسم_النقطة]
مثال: 1000-P001
```

يفصل النظام تلقائياً:
- `area_q` = 1000
- `point_name` = P001

## أفضل الممارسات

### 1. في الميدان

- استخدام تسمية متسقة للنقاط
- تضمين رمز المنطقة في اسم النقطة
- تدوين نظام المرجع المُستخدم

### 2. الاستيراد

- التحقق من صيغة المدخلات الصحيحة
- فحص المعاينة قبل التصدير
- حذف النقاط الخاطئة/المكررة

### 3. ما بعد الاستيراد

- التحقق من الإحداثيات في QGIS
- فحص طبقة منسوب US
- ربط النقاط بالوحدات الطبقية الصحيحة

## حل المشكلات

### الصيغة غير معروفة

**السبب**: صيغة المحطة غير مدعومة

**الحل**:
- التصدير من المحطة بصيغة عامة (CSV)
- مراجعة توثيق المحطة

### الإحداثيات خاطئة

**الأسباب**:
- نظام مرجع مختلف
- الإزاحة غير مُطبقة

**الحلول**:
- التحقق من نظام مرجع المشروع
- تطبيق تحويل الإحداثيات

### الطبقة لم تُنشأ

**السبب**: خطأ أثناء الاستيراد

**الحل**:
- فحص سجل الأخطاء
- التحقق من صيغة ملف المخرجات
- تكرار التحويل

## المراجع

### الملفات المصدرية
- `tabs/tops_pyarchinit.py` - الواجهة الرئيسية
- `gui/ui/Tops2pyarchinit.ui` - تخطيط واجهة المستخدم

### البرامج الخارجية
- [Total Open Station](https://tops.iosa.it/) - البرنامج الرئيسي
- توثيق صيغ المحطات

---

## فيديو تعليمي

### استيراد TOPS
`[فيديو مؤقت: video_tops.mp4]`

**المحتويات**:
- التنزيل من المحطة المساحية
- تحويل الصيغ
- الاستيراد في PyArchInit
- التكامل مع منسوب US

**المدة المتوقعة**: 12-15 دقيقة

---

*آخر تحديث: يناير 2026*
