# PyArchInit - StratiGraph: معرفات UUID

## الفهرس
1. [مقدمة](#مقدمة)
2. [ما هي معرفات UUID](#ما-هي-معرفات-uuid)
3. [لماذا نحتاج معرفات UUID في StratiGraph](#لماذا-نحتاج-معرفات-uuid-في-stratigraph)
4. [كيف تعمل في PyArchInit](#كيف-تعمل-في-pyarchinit)
5. [الجداول التي تحتوي على UUID](#الجداول-التي-تحتوي-على-uuid)
6. [الأسئلة الشائعة](#الأسئلة-الشائعة)

---

## مقدمة

ابتداءً من الإصدار **5.0.1-alpha**، يدمج PyArchInit نظام **معرفات عالمية (UUID)** لجميع الكيانات الأثرية. هذه الوظيفة جزء من مشروع **StratiGraph** الأوروبي (Horizon Europe) وتضمن أن كل سجل في قاعدة البيانات له معرّف مستقر وفريد على المستوى العالمي.

<!-- VIDEO: مقدمة عن UUID في StratiGraph -->
> **فيديو تعليمي**: [إدراج رابط فيديو مقدمة UUID]

---

## ما هي معرفات UUID

**UUID** (Universally Unique Identifier) هو رمز أبجدي رقمي من 128 بت يحدد كياناً بشكل فريد. يستخدم PyArchInit الإصدار 4 (UUID v4)، المُولّد بشكل عشوائي.

### مثال على UUID

```
a3f7b2c1-8d4e-4f5a-9b6c-1234567890ab
```

### خصائص UUID

| الخاصية | الوصف |
|---------|-------|
| **التنسيق** | 32 حرفاً سداسي عشري مفصولة بشرطات (8-4-4-4-12) |
| **الفرادة** | احتمال التصادم ضئيل إحصائياً (~1 من 2^122) |
| **الاستقلالية** | لا يعتمد على قاعدة البيانات أو الخادم أو وقت الإنشاء |
| **الثبات** | بمجرد تعيينه، لا يتغير أبداً |
| **الإصدار** | UUID v4 (مُولّد عشوائياً) |

### الفرق مع المعرفات التقليدية

| نوع المعرّف | مثال | مستقر بين قواعد البيانات؟ | فريد عالمياً؟ |
|------------|------|---------------------------|---------------|
| تزايد تلقائي (id_us) | `1`, `2`, `3`... | لا | لا |
| قيد مركب | `Sito1-Area1-US100` | نعم (دلالي) | يعتمد |
| **UUID** | `a3f7b2c1-8d4e-...` | **نعم** | **نعم** |

المعرفات ذات التزايد التلقائي (`id_us`، `id_invmat`، إلخ) تتغير عند نسخ قاعدة بيانات أو استيراد بيانات. بينما تظل معرفات UUID **دائماً نفسها**، بغض النظر عن مكان تواجد البيانات.

---

## لماذا نحتاج معرفات UUID في StratiGraph

يتطلب مشروع StratiGraph أن تكون البيانات الأثرية قادرة على:

### 1. التصدير إلى الرسم البياني المعرفي

يتم تصدير بيانات PyArchInit كـ **حزم** (packages مهيكلة) إلى رسم بياني معرفي مركزي. يجب أن يكون لكل كيان معرّف مستقر ليتم التعرف عليه في الرسم البياني.

```
كيان محلي (PyArchInit)  -->  UUID  -->  رسم بياني معرفي (StratiGraph)
     US 100                   a3f7b2c1...        E18 Physical Thing
```

### 2. المزامنة بين الأجهزة

عند العمل في الميدان بدون اتصال بالإنترنت، يتم حفظ البيانات محلياً. عند عودة الاتصال، يتم مزامنة البيانات. تضمن معرفات UUID التعرف على نفس السجل وتحديثه (وعدم تكراره).

### 3. التخطيط إلى CIDOC-CRM

تتطلب أونتولوجيا CIDOC-CRM **معرفات URI ثابتة** لكل كيان. تُستخدم معرفات UUID لبناء هذه المعرفات:

```
http://pyarchinit.org/entity/a3f7b2c1-8d4e-4f5a-9b6c-1234567890ab
```

### 4. التتبع عبر الزمن

كل تعديل أو تصدير أو مزامنة يشير إلى نفس UUID. هذا يسمح بـ:
- إعادة بناء تاريخ السجل
- التحقق من مصدر البيانات
- ربط البيانات بين مشاريع مختلفة

---

## كيف تعمل في PyArchInit

### التوليد التلقائي

يتم توليد معرفات UUID **تلقائياً** في لحظتين:

| اللحظة | الوصف |
|--------|-------|
| **إنشاء سجل جديد** | عند إدراج سجل جديد (مثل US جديدة)، يتم توليد UUID v4 تلقائياً |
| **ترحيل قاعدة بيانات موجودة** | عند أول تشغيل بعد التحديث، جميع السجلات الموجودة بدون UUID تتلقى UUID مُولّد |

المستخدم **لا يحتاج لفعل شيء**: يتم إدارة معرفات UUID بالكامل من قبل النظام.

### أين يوجد UUID

كل جدول رئيسي في قاعدة البيانات يحتوي على عمود `entity_uuid` من نوع TEXT. الحقل مرئي في قاعدة البيانات لكنه لا يظهر في نماذج الإدخال، لأنه يُدار داخلياً.

### الترحيل التلقائي

عند تحديث PyArchInit إلى الإصدار 5.0.1-alpha (أو أحدث):

1. **عند أول تشغيل**، يتحقق النظام إذا كانت الجداول تحتوي على عمود `entity_uuid`
2. إذا كان مفقوداً، يتم **إضافة العمود تلقائياً**
3. السجلات الموجودة التي لا تحتوي على UUID تتلقى **UUID مُولّد**
4. تحدث هذه العملية **مرة واحدة فقط** لكل جلسة QGIS

العملية شفافة ولا تتطلب تدخلاً يدوياً. تعمل مع **PostgreSQL** و **SQLite**.

---

## الجداول التي تحتوي على UUID

عمود `entity_uuid` موجود في الجداول الـ19 التالية:

| الجدول | المحتوى |
|--------|---------|
| `site_table` | المواقع الأثرية |
| `us_table` | الوحدات الطبقية (US/USM) |
| `inventario_materiali_table` | جرد المواد |
| `tomba_table` | المقابر |
| `periodizzazione_table` | التأريخ والمراحل |
| `struttura_table` | البنى |
| `campioni_table` | العينات |
| `individui_table` | الأفراد الأنثروبولوجيين |
| `pottery_table` | الخزف |
| `media_table` | ملفات الوسائط |
| `media_thumb_table` | صور مصغرة للوسائط |
| `media_to_entity_table` | علاقات الوسائط-الكيان |
| `fauna_table` | بيانات علم الحيوان الأثري (الحيوانات) |
| `ut_table` | الوحدات الطبوغرافية |
| `tma_materiali_archeologici` | TMA مواد أثرية |
| `tma_materiali_ripetibili` | TMA مواد متكررة |
| `archeozoology_table` | علم الحيوان الأثري |
| `documentazione_table` | التوثيق |
| `inventario_lapidei_table` | جرد الأحجار |

---

## الأسئلة الشائعة

### هل يجب علي إدخال UUID يدوياً؟

**لا.** يتم توليد معرفات UUID تلقائياً من قبل النظام. ليس من الضروري (أو الموصى به) تعديلها يدوياً.

### ماذا يحدث إذا نسخت قاعدة البيانات؟

يتم نسخ معرفات UUID مع قاعدة البيانات. هذا هو السلوك المطلوب: نفس السجل يحتفظ بنفس UUID حتى في نسخ مختلفة من قاعدة البيانات.

### هل يمكنني رؤية UUID في النماذج؟

حالياً معرفات UUID غير مرئية في نماذج الإدخال. هي مرئية مباشرة في قاعدة البيانات (مثلاً عبر DB Manager في QGIS) في عمود `entity_uuid` لكل جدول.

### هل تبطئ UUID قاعدة البيانات؟

لا. UUID هو ببساطة حقل TEXT وليس له تأثير كبير على أداء قاعدة البيانات.

### ماذا يحدث لقواعد البيانات الموجودة؟

يتم تحديث قواعد البيانات الموجودة تلقائياً عند أول تشغيل: يتم إضافة عمود `entity_uuid` وجميع السجلات الموجودة تتلقى UUID مُولّد.

### هل تعمل UUID مع PostgreSQL و SQLite؟

نعم. النظام متوافق مع كلا نوعي قواعد البيانات المدعومة من PyArchInit.

---

*توثيق PyArchInit - StratiGraph UUID*
*الإصدار: 5.0.1-alpha*
*آخر تحديث: فبراير 2026*
