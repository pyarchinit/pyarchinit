# الدرس 21: بطاقة الوحدة الطبوغرافية (UT)

## المقدمة

**بطاقة الوحدة الطبوغرافية** (UT) هي وحدة PyArchInit المخصصة لتوثيق المسوحات الأثرية السطحية (survey). تتيح تسجيل البيانات المتعلقة بتركيزات المواد، وشذوذات التضاريس، والمواقع المُحددة أثناء عمليات المسح.

### المفاهيم الأساسية

**الوحدة الطبوغرافية (UT):**
- منطقة محددة ذات خصائص أثرية متجانسة
- مُحددة أثناء المسح السطحي
- معرفة بتركيز المواد أو الشذوذات المرئية

**المسح (Survey):**
- استكشاف منهجي للإقليم
- جمع بيانات عن الوجود البشري القديم
- توثيق دون حفر

---

## الوصول إلى البطاقة

### عبر القائمة
1. قائمة **PyArchInit** في شريط قوائم QGIS
2. اختيار **بطاقة UT** (أو **TU form**)

### عبر شريط الأدوات
1. تحديد شريط أدوات PyArchInit
2. النقر على أيقونة **UT**

---

## نظرة عامة على الواجهة

البطاقة منظمة في عدة علامات تبويب لتوثيق جميع جوانب المسح.

### علامات التبويب الرئيسية

| # | علامة التبويب | الوصف |
|---|---------------|-------|
| 1 | التعريف | المشروع، رقم UT، الموقع |
| 2 | الوصف | التعريف، الوصف، التفسير |
| 3 | بيانات UT | الظروف، المنهجية، التواريخ |
| 4 | التحليل | الإمكانات والمخاطر الأثرية |

### شريط الأدوات الرئيسي

| الزر | الوظيفة |
|------|---------|
| الأول | الانتقال إلى أول سجل |
| السابق | السجل السابق |
| التالي | السجل التالي |
| الأخير | الانتقال إلى آخر سجل |
| بحث | بحث متقدم |
| حفظ | حفظ السجل |
| حذف | حذف السجل |
| PDF | تصدير بطاقة PDF |
| **قائمة PDF** | تصدير قائمة UT إلى PDF |
| **تصدير GNA** | التصدير بتنسيق GNA |
| عرض الطبقة | عرض الطبقة على الخريطة |

---

## حقول التعريف

### المشروع

**الحقل**: `comboBox_progetto`
**قاعدة البيانات**: `progetto`

اسم مشروع المسح.

### رقم UT

**الحقل**: `comboBox_nr_ut`
**قاعدة البيانات**: `nr_ut`

الرقم التسلسلي للوحدة الطبوغرافية.

### UT الحرفي

**الحقل**: `lineEdit_ut_letterale`
**قاعدة البيانات**: `ut_letterale`

لاحقة أبجدية محتملة (مثال: UT 15a، 15b).

---

## حقول الموقع

### البيانات الإدارية

| الحقل | قاعدة البيانات | الوصف |
|-------|----------------|-------|
| الدولة | `nazione` | البلد |
| المنطقة | `regione` | المنطقة الإدارية |
| المحافظة | `provincia` | المحافظة |
| البلدية | `comune` | البلدية |
| الحي | `frazione` | الحي/المحلة |
| المكان | `localita` | الاسم المحلي |
| العنوان | `indirizzo` | الشارع |
| الرقم | `nr_civico` | رقم المبنى |

### البيانات الخرائطية

| الحقل | قاعدة البيانات | الوصف |
|-------|----------------|-------|
| خريطة IGM | `carta_topo_igm` | ورقة IGM |
| خريطة CTR | `carta_ctr` | عنصر CTR |
| الورقة المساحية | `foglio_catastale` | مرجع المساحة |

### الإحداثيات

| الحقل | قاعدة البيانات | الوصف |
|-------|----------------|-------|
| الإحداثيات الجغرافية | `coord_geografiche` | خط العرض/الطول (التنسيق: lat, lon) |
| الإحداثيات المستوية | `coord_piane` | UTM/Gauss-Boaga (التنسيق: x, y) |
| الارتفاع | `quota` | الارتفاع فوق سطح البحر |
| دقة الإحداثيات | `coordinate_precision` | دقة GPS بالأمتار |

**تحذير هام**: تُستخدم الإحداثيات لتوليد خرائط الحرارة. يجب ملء واحد على الأقل من `coord_geografiche` أو `coord_piane` لكل UT.

---

## الحقول الوصفية

### تعريف UT

**الحقل**: `comboBox_def_ut`
**قاعدة البيانات**: `def_ut`
**القاموس**: الكود 12.7

التصنيف النمطي للوحدة الطبوغرافية. يتم تحميل القيم من القاموس وترجمتها تلقائياً إلى اللغة الحالية.

**القيم القياسية:**
| الرمز | العربية | الإنجليزية |
|-------|---------|------------|
| scatter | منطقة تشتت مواد | Material scatter |
| site | موقع أثري | Archaeological site |
| anomaly | شذوذ التضاريس | Terrain anomaly |
| structure | هيكل ظاهر | Outcropping structure |
| concentration | تركيز لقى | Finds concentration |
| traces | آثار بشرية | Anthropic traces |
| findspot | اكتشاف متفرق | Sporadic find |
| negative | نتيجة سلبية | Negative result |

### وصف UT

**الحقل**: `textEdit_descrizione`
**قاعدة البيانات**: `descrizione_ut`

وصف مفصل للوحدة الطبوغرافية.

**المحتويات:**
- امتداد وشكل المنطقة
- كثافة المواد
- خصائص التضاريس
- الرؤية والظروف

### تفسير UT

**الحقل**: `textEdit_interpretazione`
**قاعدة البيانات**: `interpretazione_ut`

التفسير الوظيفي/التاريخي.

---

## حقول المسح مع القاموس

تستخدم الحقول التالية نظام القاموس لضمان مصطلحات موحدة ومترجمة إلى 7 لغات (IT، EN، DE، ES، FR، AR، CA).

### نوع المسح (12.1)

**الحقل**: `comboBox_survey_type`
**قاعدة البيانات**: `survey_type`

| الرمز | العربية | الوصف |
|-------|---------|-------|
| intensive | مسح مكثف | مسح منهجي مكثف |
| extensive | مسح موسع | مسح بأخذ العينات |
| targeted | مسح موجه | تحقيق في مناطق محددة |
| random | أخذ عينات عشوائي | منهجية عشوائية |

### تغطية النباتات (12.2)

**الحقل**: `comboBox_vegetation_coverage`
**قاعدة البيانات**: `vegetation_coverage`

| الرمز | العربية | الوصف |
|-------|---------|-------|
| none | غائبة | تربة عارية |
| sparse | متفرقة | تغطية < 25% |
| moderate | معتدلة | تغطية 25-50% |
| dense | كثيفة | تغطية 50-75% |
| very_dense | كثيفة جداً | تغطية > 75% |

### طريقة GPS (12.3)

**الحقل**: `comboBox_gps_method`
**قاعدة البيانات**: `gps_method`

| الرمز | العربية | الوصف |
|-------|---------|-------|
| handheld | GPS محمول | جهاز GPS محمول |
| dgps | GPS تفاضلي | DGPS مع محطة قاعدة |
| rtk | GPS RTK | حركي في الوقت الحقيقي |
| total_station | محطة رصد كاملة | رفع بمحطة رصد كاملة |

### حالة السطح (12.4)

**الحقل**: `comboBox_surface_condition`
**قاعدة البيانات**: `surface_condition`

| الرمز | العربية | الوصف |
|-------|---------|-------|
| ploughed | محروث | حقل محروث حديثاً |
| stubble | قش | وجود قش |
| pasture | مرعى | أرض رعي/مرج |
| woodland | غابة | منطقة غابات |
| urban | حضري | منطقة حضرية/مبنية |

### إمكانية الوصول (12.5)

**الحقل**: `comboBox_accessibility`
**قاعدة البيانات**: `accessibility`

| الرمز | العربية | الوصف |
|-------|---------|-------|
| easy | وصول سهل | بدون قيود |
| moderate_access | وصول معتدل | بعض الصعوبات |
| difficult | وصول صعب | مشاكل كبيرة |
| restricted | وصول مقيد | بتصريح فقط |

### الظروف الجوية (12.6)

**الحقل**: `comboBox_weather_conditions`
**قاعدة البيانات**: `weather_conditions`

| الرمز | العربية | الوصف |
|-------|---------|-------|
| sunny | مشمس | طقس صافٍ |
| cloudy | غائم | ظروف غائمة |
| rainy | ممطر | مطر أثناء المسح |
| windy | عاصف | رياح قوية |

---

## البيانات البيئية

### نسبة الرؤية

**الحقل**: `spinBox_visibility_percent`
**قاعدة البيانات**: `visibility_percent`

نسبة رؤية التربة (0-100%). قيمة رقمية مهمة لحساب الإمكانات الأثرية.

### تضاريس الأرض

**الحقل**: `lineEdit_andamento_terreno_pendenza`
**قاعدة البيانات**: `andamento_terreno_pendenza`

المورفولوجيا والميل.

### استخدام الأرض

**الحقل**: `lineEdit_utilizzo_suolo_vegetazione`
**قاعدة البيانات**: `utilizzo_suolo_vegetazione`

استخدام الأرض وقت المسح.

---

## بيانات المواد

### أبعاد UT

**الحقل**: `lineEdit_dimensioni_ut`
**قاعدة البيانات**: `dimensioni_ut`

المساحة بالمتر المربع.

### القطع لكل م²

**الحقل**: `lineEdit_rep_per_mq`
**قاعدة البيانات**: `rep_per_mq`

كثافة المواد لكل متر مربع. قيمة حرجة لحساب الإمكانات.

### القطع المؤرخة

**الحقل**: `lineEdit_rep_datanti`
**قاعدة البيانات**: `rep_datanti`

وصف المواد التشخيصية.

---

## التسلسل الزمني

### الفترة الأولى

| الحقل | قاعدة البيانات |
|-------|----------------|
| الفترة I | `periodo_I` |
| التأريخ I | `datazione_I` |
| التفسير I | `interpretazione_I` |

### الفترة الثانية

| الحقل | قاعدة البيانات |
|-------|----------------|
| الفترة II | `periodo_II` |
| التأريخ II | `datazione_II` |
| التفسير II | `interpretazione_II` |

---

## علامة تبويب التحليل - الإمكانات والمخاطر الأثرية

توفر علامة تبويب **التحليل** أدوات متقدمة للحساب التلقائي للإمكانات والمخاطر الأثرية.

### الإمكانات الأثرية

يحسب النظام درجة من 0 إلى 100 بناءً على عدة عوامل موزونة:

| العامل | الوزن | الوصف | طريقة الحساب |
|--------|-------|-------|---------------|
| تعريف UT | 30% | نوع الدليل الأثري | "site" = 100، "structure" = 90، "concentration" = 80، "scatter" = 60، إلخ |
| الفترة التاريخية | 25% | تأريخ المواد | الفترات القديمة لها وزن أكبر (ما قبل التاريخ = 90، روماني = 85، قروسطي = 70، إلخ) |
| كثافة اللقى | 20% | المواد لكل م² | >10/م² = 100، 5-10 = 80، 2-5 = 60، <2 = 40 |
| حالة السطح | 15% | الرؤية وإمكانية الوصول | "ploughed" = 90، "stubble" = 70، "pasture" = 50، "woodland" = 30 |
| التوثيق | 10% | جودة التوثيق | وجود صور = +20، ببليوغرافيا = +30، تحقيقات = +50 |

**تصنيف الدرجة:**

| الدرجة | المستوى | اللون | المعنى |
|--------|---------|-------|--------|
| 80-100 | عالٍ | أخضر | احتمال مرتفع لوجود رواسب مهمة |
| 60-79 | متوسط-عالٍ | أصفر-أخضر | احتمال جيد، يُنصح بالتحقق |
| 40-59 | متوسط | برتقالي | احتمال معتدل |
| 20-39 | منخفض | أحمر | احتمال منخفض |
| 0-19 | غير قابل للتقييم | رمادي | بيانات غير كافية |

### المخاطر الأثرية

تقييم خطر التأثير/فقدان التراث:

| العامل | الوزن | الوصف | طريقة الحساب |
|--------|-------|-------|---------------|
| إمكانية الوصول | 25% | سهولة الوصول للمنطقة | "easy" = 80، "moderate" = 50، "difficult" = 30، "restricted" = 10 |
| استخدام الأرض | 25% | الأنشطة الزراعية/البناء | "urban" = 90، "ploughed" = 70، "pasture" = 40، "woodland" = 20 |
| القيود الموجودة | 20% | الحماية القانونية | عدم وجود قيود = 80، قيد مناظر طبيعية = 40، قيد أثري = 10 |
| التحقيقات السابقة | 15% | حالة المعرفة | لا تحقيقات = 60، مسح = 40، حفر = 20 |
| الإمكانات | 15% | عكسياً متناسب مع الإمكانات | إمكانات عالية = خطر فقدان عالٍ |

**تصنيف المخاطر:**

| الدرجة | المستوى | اللون | الإجراء الموصى به |
|--------|---------|-------|-------------------|
| 75-100 | عالٍ | أحمر | تدخل عاجل، إجراءات حماية فورية |
| 50-74 | متوسط | برتقالي | مراقبة نشطة، تقييم الحماية |
| 25-49 | منخفض | أصفر | مراقبة دورية |
| 0-24 | معدوم | أخضر | لا حاجة لتدخل فوري |

### حقول قاعدة البيانات للتحليل

| الحقل | قاعدة البيانات | الوصف |
|-------|----------------|-------|
| درجة الإمكانات | `potential_score` | قيمة 0-100 محسوبة |
| درجة المخاطر | `risk_score` | قيمة 0-100 محسوبة |
| عوامل الإمكانات | `potential_factors` | JSON مع تفاصيل العوامل |
| عوامل المخاطر | `risk_factors` | JSON مع تفاصيل العوامل |
| تاريخ التحليل | `analysis_date` | طابع زمني للحساب |
| طريقة التحليل | `analysis_method` | الخوارزمية المستخدمة |

---

## طبقات الهندسة UT

يدير PyArchInit ثلاثة أنواع من الهندسات للوحدات الطبوغرافية:

### جداول الهندسة

| الطبقة | الجدول | نوع الهندسة | الاستخدام |
|--------|--------|-------------|----------|
| نقاط UT | `pyarchinit_ut_point` | Point | تحديد موقع نقطي |
| خطوط UT | `pyarchinit_ut_line` | LineString | مسارات، طرق |
| مضلعات UT | `pyarchinit_ut_polygon` | Polygon | مناطق التشتت |

### إنشاء طبقة UT

1. **عبر متصفح QGIS:**
   - فتح قاعدة البيانات في المتصفح
   - تحديد جدول `pyarchinit_ut_point/line/polygon`
   - سحبه إلى الخريطة

2. **عبر قائمة PyArchInit:**
   - قائمة **PyArchInit** > **أدوات GIS** > **تحميل طبقات UT**
   - اختيار نوع الهندسة

### الربط بين UT والهندسة

كل سجل هندسي مرتبط ببطاقة UT عبر:

| الحقل | الوصف |
|-------|-------|
| `progetto` | اسم المشروع (يجب أن يتطابق) |
| `nr_ut` | رقم UT (يجب أن يتطابق) |

### سير عمل إنشاء الهندسات

1. **تفعيل التحرير** على طبقة UT المطلوبة
2. **رسم** الهندسة على الخريطة
3. **ملء** السمات `progetto` و `nr_ut`
4. **حفظ** الطبقة
5. **التحقق** من الربط من بطاقة UT

---

## توليد خرائط الحرارة

تتيح وحدة توليد خرائط الحرارة تصور التوزيع المكاني للإمكانات والمخاطر الأثرية.

### المتطلبات الدنيا

- **على الأقل 2 UT** مع إحداثيات صالحة (`coord_geografiche` أو `coord_piane`)
- **درجات محسوبة** للإمكانات و/أو المخاطر
- **نظام إحداثيات محدد** في مشروع QGIS

### طرق الاستيفاء

| الطريقة | الوصف | متى تُستخدم |
|---------|-------|-------------|
| **KDE** (Kernel Density) | تقدير كثافة نواة غاوسية | توزيع مستمر، نقاط كثيرة |
| **IDW** (Inverse Distance) | وزن عكسي للمسافة | بيانات متفرقة، قيم نقطية مهمة |
| **Grid** | استيفاء على شبكة منتظمة | تحليلات منهجية |

### معلمات خريطة الحرارة

| المعلمة | القيمة الافتراضية | الوصف |
|---------|------------------|-------|
| حجم الخلية | 50 م | دقة الشبكة |
| عرض النطاق (KDE) | تلقائي | نصف قطر التأثير |
| الأس (IDW) | 2 | أس الترجيح |

### إجراء التوليد

1. **من بطاقة UT:**
   - الانتقال إلى علامة تبويب **التحليل**
   - التحقق من حساب الدرجات
   - النقر على **توليد خريطة حرارة**

2. **اختيار المعلمات:**
   - النوع: الإمكانات أو المخاطر
   - الطريقة: KDE، IDW، أو Grid
   - حجم الخلية: عادة 25-100 م

3. **المخرجات:**
   - طبقة نقطية تُضاف إلى QGIS
   - تُحفظ في `pyarchinit_Raster_folder`
   - ترميز يُطبق تلقائياً

### خريطة حرارة مع قناع مضلع (GNA)

لتوليد خرائط حرارة **داخل منطقة مشروع** (مثل محيط الدراسة):

1. **إعداد مضلع** منطقة المشروع
2. **استخدام تصدير GNA** (انظر القسم التالي)
3. يقوم النظام **بقص** خريطة الحرارة تلقائياً للمضلع

---

## تصدير GNA - البوابة الوطنية للآثار

### ما هو GNA؟

**البوابة الوطنية للآثار** (GNA) هو نظام المعلومات التابع لوزارة الثقافة الإيطالية لإدارة البيانات الأثرية الإقليمية. يدعم PyArchInit التصدير بتنسيق GeoPackage القياسي GNA.

### هيكل GeoPackage GNA

| الطبقة | النوع | الوصف |
|--------|------|-------|
| **MOPR** | Polygon | منطقة/محيط المشروع |
| **MOSI** | Point/Polygon | المواقع الأثرية (UT) |
| **VRP** | MultiPolygon | خريطة الإمكانات الأثرية |
| **VRD** | MultiPolygon | خريطة المخاطر الأثرية |

### تعيين حقول UT على MOSI GNA

| حقل GNA | حقل UT PyArchInit | ملاحظات |
|---------|-------------------|--------|
| ID | `{progetto}_{nr_ut}` | معرف مركب |
| AMA | `def_ut` | مفردات GNA المضبوطة |
| OGD | `interpretazione_ut` | تعريف الكائن |
| OGT | `geometria` | نوع الهندسة |
| DES | `descrizione_ut` | الوصف (حد أقصى 10000 حرف) |
| OGM | `metodo_rilievo_e_ricognizione` | طريقة التحديد |
| DTSI | `periodo_I` -> تاريخ | تاريخ البداية (سالب لقبل الميلاد) |
| DTSF | `periodo_II` -> تاريخ | تاريخ النهاية |
| PRVN | `nazione` | الدولة |
| PVCR | `regione` | المنطقة |
| PVCP | `provincia` | المحافظة |
| PVCC | `comune` | البلدية |
| LCDQ | `quota` | الارتفاع فوق سطح البحر |

### تصنيف VRP (الإمكانات)

| النطاق | كود GNA | التسمية | اللون |
|--------|---------|---------|-------|
| 0-20 | NV | غير قابل للتقييم | رمادي |
| 20-40 | NU | معدوم | أخضر |
| 40-60 | BA | منخفض | أصفر |
| 60-80 | ME | متوسط | برتقالي |
| 80-100 | AL | عالٍ | أحمر |

### تصنيف VRD (المخاطر)

| النطاق | كود GNA | التسمية | اللون |
|--------|---------|---------|-------|
| 0-25 | NU | معدوم | أخضر |
| 25-50 | BA | منخفض | أصفر |
| 50-75 | ME | متوسط | برتقالي |
| 75-100 | AL | عالٍ | أحمر |

### إجراء تصدير GNA

1. **إعداد البيانات:**
   - التحقق من أن جميع UT لها إحداثيات
   - حساب درجات الإمكانات/المخاطر
   - إعداد مضلع منطقة المشروع (MOPR)

2. **بدء التصدير:**
   - من بطاقة UT، النقر على **تصدير GNA**
   - أو قائمة **PyArchInit** > **GNA** > **تصدير**

3. **التكوين:**
   ```
   المشروع: [اختر المشروع]
   منطقة المشروع: [اختر طبقة مضلع MOPR]
   المخرجات: [مسار ملف .gpkg]

   اختر تصدير MOSI (المواقع)
   اختر توليد VRP (الإمكانات)
   اختر توليد VRD (المخاطر)

   طريقة خريطة الحرارة: KDE
   حجم الخلية: 50 م
   ```

4. **التنفيذ:**
   - النقر على **تصدير**
   - انتظار التوليد (قد يستغرق عدة دقائق)
   - يُحفظ GeoPackage في المسار المحدد

5. **التحقق من المخرجات:**
   - فتح GeoPackage في QGIS
   - التحقق من طبقات MOPR، MOSI، VRP، VRD
   - التأكد من قص هندسات VRP/VRD لـ MOPR

### التحقق من صحة GNA

للتحقق من المخرجات مقابل مواصفات GNA:

1. تحميل GeoPackage في **قالب GNA الرسمي**
2. التحقق من التعرف على الطبقات
3. فحص المفردات المضبوطة
4. التحقق من العلاقات الهندسية (MOSI داخل MOPR)

---

## تصدير PDF

### بطاقة UT مفردة

تصدير بطاقة UT الكاملة بتنسيق PDF احترافي.

**المحتوى:**
- رأس مع المشروع ورقم UT
- قسم التعريف
- قسم الموقع
- قسم التضاريس
- قسم بيانات المسح
- قسم التسلسل الزمني
- قسم التحليل (الإمكانات/المخاطر مع أشرطة ملونة)
- قسم التوثيق

**الإجراء:**
1. اختيار سجل UT
2. النقر على زر **PDF** في شريط الأدوات
3. يُحفظ PDF في `pyarchinit_PDF_folder`

### قائمة UT (قائمة PDF)

تصدير قائمة جدولية لجميع UT بتنسيق أفقي.

**الأعمدة:**
- UT، المشروع، التعريف، التفسير
- البلدية، الإحداثيات، الفترة I، الفترة II
- لقى/م²، الرؤية، الإمكانات، المخاطر

**الإجراء:**
1. تحميل UT للتصدير (بحث أو عرض الكل)
2. النقر على زر **قائمة PDF** في شريط الأدوات
3. يُحفظ PDF باسم `Elenco_UT.pdf`

### تقرير تحليل UT

توليد تقرير مفصل لتحليل الإمكانات/المخاطر.

**المحتوى:**
1. بيانات تعريف UT
2. قسم الإمكانات الأثرية
   - الدرجة مع مؤشر رسومي
   - نص سردي وصفي
   - جدول العوامل مع المساهمات
3. قسم المخاطر الأثرية
   - الدرجة مع مؤشر رسومي
   - نص سردي مع التوصيات
   - جدول العوامل مع المساهمات
4. قسم المنهجية

---

## سير العمل التشغيلي الكامل

### المرحلة 1: إعداد المشروع

1. **إنشاء مشروع جديد** في PyArchInit أو استخدام مشروع موجود
2. **تحديد منطقة الدراسة** (مضلع MOPR)
3. **تكوين نظام الإحداثيات** لمشروع QGIS

### المرحلة 2: تسجيل UT في الميدان

1. **فتح بطاقة UT**
2. **سجل جديد** (النقر على "سجل جديد")
3. **ملء بيانات التعريف:**
   ```
   المشروع: مسح وادي النيل 2024
   رقم UT: 25
   ```

4. **ملء الموقع:**
   ```
   المنطقة: القاهرة
   المحافظة: الجيزة
   البلدية: الهرم
   المكان: التل الشرقي
   الإحداثيات الجغرافية: 29.9792, 31.1342
   الارتفاع: 125 م
   دقة GPS: 3 م
   ```

5. **ملء الوصف** (باستخدام القاموس):
   ```
   التعريف: تركيز لقى
   الوصف: منطقة بيضاوية حوالي 50×30 م
   مع تركيز شظايا فخارية
   وآجر على منحدر تلة...
   ```

6. **ملء بيانات المسح** (باستخدام القاموس):
   ```
   نوع المسح: مسح مكثف
   تغطية النباتات: متفرقة
   طريقة GPS: GPS تفاضلي
   حالة السطح: محروث
   إمكانية الوصول: وصول سهل
   الظروف الجوية: مشمس
   الرؤية: 80%
   التاريخ: 15/04/2024
   المسؤول: الفريق أ
   ```

7. **ملء المواد والتسلسل الزمني:**
   ```
   الأبعاد: 1500 م²
   لقى/م²: 5-8
   اللقى المؤرخة: فخار عادي،
   سيجيلاتا، آجر

   الفترة I: روماني
   التأريخ I: القرن I-II م
   التفسير I: فيلا ريفية
   ```

8. **الحفظ** (النقر على "حفظ")

### المرحلة 3: إنشاء الهندسات

1. **تحميل طبقة** `pyarchinit_ut_polygon`
2. **تفعيل التحرير**
3. **رسم** محيط UT على الخريطة
4. **ملء السمات**: progetto، nr_ut
5. **حفظ** الطبقة

### المرحلة 4: التحليل

1. **فتح علامة تبويب التحليل** في بطاقة UT
2. **التحقق** من الدرجات المحسوبة تلقائياً
3. **توليد خريطة حرارة** إذا لزم الأمر
4. **تصدير تقرير PDF** للتحليل

### المرحلة 5: تصدير GNA (إذا طُلب)

1. **التحقق من اكتمال البيانات** لجميع UT
2. **إعداد مضلع MOPR** لمنطقة المشروع
3. **تنفيذ تصدير GNA**
4. **التحقق من المخرجات** مقابل مواصفات GNA

---

## نصائح وحيل

### تحسين سير العمل

1. **ملء القواميس مسبقاً** قبل بدء المسوحات
2. **استخدام قوالب المشروع** مع البيانات المشتركة المعدة مسبقاً
3. **مزامنة الإحداثيات** من GPS إلى حقل `coord_geografiche`
4. **الحفظ المتكرر** أثناء الملء

### تحسين جودة البيانات

1. **ملء جميع الحقول** ذات الصلة لكل UT
2. **استخدام القواميس دائماً** بدلاً من النص الحر
3. **التحقق من الإحداثيات** على الخريطة قبل الحفظ
4. **توثيق كل UT فوتوغرافياً**

### تحسين خرائط الحرارة

1. **حجم خلية مناسب**: استخدم 25-50م للمناطق الصغيرة، 100-200م للمناطق الواسعة
2. **طريقة KDE** للتوزيعات المستمرة والمتجانسة
3. **طريقة IDW** عندما تكون القيم النقطية حرجة
4. **التحقق دائماً** من صحة الإحداثيات قبل التوليد

### تصدير GNA فعال

1. **إعداد مضلع MOPR** مسبقاً كطبقة منفصلة
2. **التحقق من أن جميع UT** لها إحداثيات صالحة
3. **حساب الدرجات** قبل التصدير
4. **استخدام أسماء ملفات** وصفية لـ GeoPackage

### إدارة متعددة المستخدمين

1. **تحديد اتفاقيات** ترقيم UT مشتركة
2. **استخدام قاعدة بيانات PostgreSQL** للوصول المتزامن
3. **المزامنة الدورية** للبيانات
4. **توثيق التعديلات** في حقول الملاحظات

---

## حل المشكلات

### المشكلة: قوائم القاموس فارغة

**الأعراض:** القوائم المنسدلة لـ survey_type، vegetation، إلخ فارغة.

**الأسباب:**
- مدخلات القاموس غير موجودة في قاعدة البيانات
- كود اللغة خاطئ
- جدول القاموس غير محدث

**الحلول:**
1. قائمة **PyArchInit** > **قاعدة البيانات** > **تحديث قاعدة البيانات**
2. التحقق من جدول `pyarchinit_thesaurus_sigle` لمدخلات `ut_table`
3. فحص إعدادات اللغة
4. إذا لزم الأمر، إعادة استيراد القواميس من القالب

### المشكلة: إحداثيات غير صالحة

**الأعراض:** خطأ في الحفظ أو إحداثيات تظهر في موقع خاطئ.

**الأسباب:**
- تنسيق خاطئ (فاصلة مقابل نقطة عشرية)
- نظام مرجعي غير متطابق
- ترتيب خط العرض/الطول معكوس

**الحلول:**
1. التنسيق الصحيح لـ `coord_geografiche`: `42.1234, 12.5678` (lat, lon)
2. التنسيق الصحيح لـ `coord_piane`: `1234567.89, 4567890.12` (x, y)
3. استخدام النقطة دائماً كفاصل عشري
4. التحقق من نظام الإحداثيات لمشروع QGIS

### المشكلة: UT غير مرئي على الخريطة

**الأعراض:** بعد الحفظ، لا يظهر UT على الخريطة.

**الأسباب:**
- الهندسة غير منشأة في الطبقة
- سمات `progetto`/`nr_ut` غير متطابقة
- الطبقة غير محملة أو مخفية
- نظام إحداثيات مختلف بين الطبقة والمشروع

**الحلول:**
1. التحقق من وجود طبقة `pyarchinit_ut_point/polygon`
2. فحص ملء السمات بشكل صحيح
3. تفعيل رؤية الطبقة في لوحة الطبقات
4. استخدام "تكبير للطبقة" للتحقق من الامتداد

### المشكلة: خريطة الحرارة لم تُولَّد

**الأعراض:** خطأ "مطلوب على الأقل نقطتان بإحداثيات صالحة".

**الأسباب:**
- أقل من 2 UT بإحداثيات
- إحداثيات بتنسيق خاطئ
- حقول الإحداثيات فارغة

**الحلول:**
1. التحقق من أن على الأقل 2 UT لها `coord_geografiche` أو `coord_piane` ممتلئة
2. فحص تنسيق الإحداثيات (نقطة عشرية، ترتيب صحيح)
3. إعادة حساب الدرجات قبل توليد خريطة الحرارة
4. التحقق من عدم احتواء الحقول على أحرف خاصة

### المشكلة: درجة الإمكانات/المخاطر غير محسوبة

**الأعراض:** حقول potential_score و risk_score فارغة أو صفر.

**الأسباب:**
- الحقول الإلزامية غير ممتلئة
- قيم القاموس غير معروفة
- خطأ في الحساب

**الحلول:**
1. ملء على الأقل: `def_ut`، `periodo_I`، `visibility_percent`
2. استخدام قيم من القاموس (ليس نص حر)
3. حفظ السجل وإعادة فتحه
4. التحقق من سجلات QGIS لأي أخطاء

### المشكلة: فشل تصدير GNA

**الأعراض:** GeoPackage لم يُنشأ أو غير مكتمل.

**الأسباب:**
- وحدة GNA غير متوفرة
- بيانات UT غير مكتملة
- مضلع MOPR غير صالح
- صلاحيات كتابة غير كافية

**الحلول:**
1. التحقق من تثبيت وحدة `modules/gna`
2. فحص أن جميع UT لها إحداثيات صالحة
3. التحقق من صلاحية مضلع MOPR (بدون تقاطعات ذاتية)
4. فحص الصلاحيات على مجلد المخرجات
5. التحقق من توفر مساحة قرص كافية

### المشكلة: تصدير PDF بحقول مفقودة

**الأعراض:** PDF المُولَّد لا يُظهر بعض الحقول أو يُظهر قيماً خاطئة.

**الأسباب:**
- حقول قاعدة البيانات غير محدثة
- إصدار مخطط قاعدة البيانات قديم
- البيانات غير محفوظة قبل التصدير

**الحلول:**
1. حفظ السجل قبل التصدير
2. تحديث قاعدة البيانات إذا لزم الأمر
3. التحقق من وجود الحقول الجديدة (v4.9.67+) في الجدول

### المشكلة: خطأ Qt6/QGIS 4.x

**الأعراض:** الإضافة لا تُحمَّل على QGIS 4.x مع خطأ `AllDockWidgetFeatures`.

**الأسباب:**
- عدم توافق Qt5/Qt6
- ملف UI غير محدث

**الحلول:**
1. تحديث PyArchInit إلى أحدث إصدار
2. يجب أن يستخدم ملف `UT_ui.ui` علامات صريحة بدلاً من `AllDockWidgetFeatures`

---

## المراجع

### قاعدة البيانات

- **الجدول**: `ut_table`
- **فئة المحول**: `UT`
- **المعرف**: `id_ut`

### جداول الهندسة

- **النقاط**: `pyarchinit_ut_point`
- **الخطوط**: `pyarchinit_ut_line`
- **المضلعات**: `pyarchinit_ut_polygon`

### الملفات المصدرية

| الملف | الوصف |
|-------|-------|
| `gui/ui/UT_ui.ui` | واجهة مستخدم Qt |
| `tabs/UT.py` | المتحكم الرئيسي |
| `modules/utility/pyarchinit_exp_UTsheet_pdf.py` | تصدير بطاقات PDF |
| `modules/utility/pyarchinit_exp_UT_analysis_pdf.py` | تصدير تحليل PDF |
| `modules/analysis/ut_potential.py` | حساب الإمكانات |
| `modules/analysis/ut_risk.py` | حساب المخاطر |
| `modules/analysis/ut_heatmap_generator.py` | توليد خرائط الحرارة |
| `modules/gna/gna_exporter.py` | تصدير GNA |
| `modules/gna/gna_vocabulary_mapper.py` | تعيين مفردات GNA |

### أكواد قاموس UT

| الكود | الحقل | الوصف |
|-------|-------|-------|
| 12.1 | survey_type | نوع المسح |
| 12.2 | vegetation_coverage | تغطية النباتات |
| 12.3 | gps_method | طريقة GPS |
| 12.4 | surface_condition | حالة السطح |
| 12.5 | accessibility | إمكانية الوصول |
| 12.6 | weather_conditions | الظروف الجوية |
| 12.7 | def_ut | تعريف UT |

---

## فيديوهات تعليمية

### توثيق المسوحات
**المدة**: 15-18 دقيقة
- تسجيل UT
- بيانات المسح مع القاموس
- تحديد الموقع الجغرافي

### تحليل الإمكانات والمخاطر
**المدة**: 10-12 دقيقة
- حساب الدرجات التلقائي
- تفسير النتائج
- توليد خرائط الحرارة

### تصدير GNA
**المدة**: 12-15 دقيقة
- إعداد البيانات
- تكوين التصدير
- التحقق من المخرجات

### تصدير تقارير PDF
**المدة**: 8-10 دقيقة
- بطاقة UT القياسية
- قائمة UT
- تقرير التحليل مع الخرائط

---

*آخر تحديث: يناير 2026*
*PyArchInit v4.9.68 - نظام إدارة البيانات الأثرية*
