# الدرس 30: استعلام قاعدة البيانات بالذكاء الاصطناعي (Text2SQL)

## المقدمة

**استعلام قاعدة البيانات بالذكاء الاصطناعي** هي ميزة متقدمة في PyArchInit تتيح استعلام قاعدة البيانات الأثرية باستخدام **اللغة الطبيعية**. يحول النظام الأسئلة تلقائياً إلى استعلامات SQL بفضل الذكاء الاصطناعي.

### كيف يعمل

1. يكتب المستخدم سؤالاً بالعربية/الإنجليزية
2. يحلل الذكاء الاصطناعي الطلب
3. يُولد استعلام SQL المقابل
4. يُنفذ الاستعلام على قاعدة البيانات
5. يُرجع النتائج

### أمثلة على الأسئلة

- *"جد جميع القطع الفخارية من موقع الفيلا الرومانية"*
- *"أظهر الوحدات الطبقية من الفترة الرومانية في المنطقة 1000"*
- *"كم عدد الأفراد الذين وُجدوا في القبور؟"*
- *"اسرد الهياكل ذات التأريخ الإسلامي"*

## الوصول

### من بطاقة US/القطع
تبويب مخصص **"استعلام AI"** أو **"Text2SQL"**

### من القائمة
**PyArchInit** ← **استعلام قاعدة البيانات بالذكاء الاصطناعي**

## الواجهة

### لوحة الاستعلام

```
+--------------------------------------------------+
|         توليد SQL بالذكاء الاصطناعي               |
+--------------------------------------------------+
| وضع التوليد:                                      |
|   (o) OpenAI GPT-4 (API مُكون)                  |
|   ( ) Ollama (نموذج محلي)                       |
|   ( ) API مجاني (إذا متاح)                      |
+--------------------------------------------------+
| نموذج Ollama: [llama3.2 v] [تحقق من Ollama]     |
+--------------------------------------------------+
| المدخلات:                                         |
|   نوع قاعدة البيانات: [sqlite | postgresql]     |
|                                                  |
|   صف الاستعلام:                                  |
|   +--------------------------------------------+ |
|   | جد جميع القطع الفخارية من موقع            | |
|   | الفيلا الرومانية بتأريخ بين القرن 1 و2   | |
|   +--------------------------------------------+ |
+--------------------------------------------------+
| [توليد SQL]  [مسح]                               |
+--------------------------------------------------+
| استعلام SQL المُولد:                              |
|   +--------------------------------------------+ |
|   | SELECT * FROM inventario_materiali_table   | |
|   | WHERE sito = 'Villa Romana'                | |
|   | AND tipo_reperto LIKE '%ceramic%'          | |
|   +--------------------------------------------+ |
| [شرح الاستعلام] [نسخ الاستعلام] [استخدم الاستعلام]|
+--------------------------------------------------+
| الشرح:                                            |
|   الاستعلام يُحدد جميع الحقول من...              |
+--------------------------------------------------+
```

## أوضاع التوليد

### 1. OpenAI GPT-4

- **المتطلبات**: مفتاح API OpenAI مُكون
- **الجودة**: ممتازة
- **التكلفة**: حسب الاستهلاك (API)
- **السرعة**: سريع

### 2. Ollama (محلي)

- **المتطلبات**: Ollama مُثبت وقيد التشغيل
- **الجودة**: جيدة-ممتازة (حسب النموذج)
- **التكلفة**: مجاني
- **السرعة**: تعتمد على العتاد

### 3. API مجاني

- **المتطلبات**: اتصال إنترنت
- **الجودة**: متغيرة
- **التكلفة**: مجاني
- **القيود**: تحديد معدل ممكن

## التكوين

### OpenAI

1. الحصول على مفتاح API من [OpenAI](https://platform.openai.com/)
2. التكوين في **PyArchInit** ← **التكوين** ← **مفاتيح API**
3. تحديد "OpenAI GPT-4" في الوضع

### Ollama

1. تثبيت Ollama من [ollama.ai](https://ollama.ai/)
2. تشغيل Ollama: `ollama serve`
3. تنزيل النموذج: `ollama pull llama3.2`
4. تحديد "Ollama" والتحقق من الاتصال

### نماذج Ollama الموصى بها

| النموذج | الحجم | جودة SQL |
|---------|-------|----------|
| llama3.2 | 2GB | جيدة |
| mistral | 4GB | ممتازة |
| codellama | 7GB | ممتازة للـ SQL |
| qwen2.5-coder | 4GB | ممتازة للبرمجة |

## الاستخدام

### 1. كتابة السؤال

في مربع الإدخال، وصف ما تريد البحث عنه:
- استخدام لغة طبيعية
- كن محدداً قدر الإمكان
- ذكر الجداول/الحقول إذا معروفة

### 2. توليد SQL

1. النقر على **"توليد SQL"**
2. انتظار المعالجة
3. عرض الاستعلام المُولد

### 3. التحقق من الاستعلام

- قراءة استعلام SQL المُولد
- النقر على **"شرح الاستعلام"** للفهم
- التحقق من الصحة المنطقية

### 4. تنفيذ الاستعلام

- **"نسخ الاستعلام"**: نسخ إلى الحافظة
- **"استخدم الاستعلام"**: تنفيذ مباشر في النظام

## مخطط قاعدة البيانات

### الجداول الرئيسية

النظام يعرف مخطط PyArchInit:

| الجدول | الوصف |
|--------|-------|
| site_table | المواقع الأثرية |
| us_table | الوحدات الطبقية |
| inventario_materiali_table | القطع |
| pottery_table | السيراميك |
| tomba_table | القبور |
| individui_table | الأفراد |
| struttura_table | الهياكل |
| periodizzazione_table | التحقيب |
| campioni_table | العينات |
| documentazione_table | التوثيق |

### الحقول الشائعة

الذكاء الاصطناعي يعرف الحقول الرئيسية:
- `sito` - اسم الموقع
- `area` - رقم المنطقة
- `us` - رقم US
- `periodo_iniziale` / `fase_iniziale`
- `datazione_estesa`
- `descrizione` / `interpretazione`

## أمثلة على الاستعلامات

### البحث عن القطع

**السؤال**: *"جد جميع القطع البرونزية من موقع روما القديمة"*

```sql
SELECT * FROM inventario_materiali_table
WHERE sito = 'Roma Antica'
AND (tipo_reperto LIKE '%bronzo%' OR definizione LIKE '%bronzo%')
```

### إحصاء US

**السؤال**: *"كم عدد US لكل فترة في موقع فيلا هادريان؟"*

```sql
SELECT periodo_iniziale, COUNT(*) as num_us
FROM us_table
WHERE sito = 'Villa Adriana'
GROUP BY periodo_iniziale
```

### البحث المكاني

**السؤال**: *"أظهر US من المنطقة 1000 بمناسيب أقل من 10 أمتار"*

```sql
SELECT * FROM us_table
WHERE area = '1000'
AND quota_min_usm < 10
```

## أفضل الممارسات

### 1. أسئلة فعالة

- كن محدداً: أسماء المواقع، الأرقام، التواريخ
- حدد ما تريد: قائمة، إحصاء، تفاصيل
- ذكر الفلاتر المطلوبة

### 2. التحقق من النتائج

- تحقق دائماً من الاستعلام المُولد
- استخدم "شرح الاستعلام" إذا غير واضح
- اختبر على مجموعة فرعية قبل الاستعلامات المعقدة

### 3. التكرار

- إذا النتيجة غير صحيحة، أعد صياغة السؤال
- أضف تفاصيل إذا الاستعلام واسع جداً
- بسّط إذا الاستعلام معقد جداً

## حل المشكلات

### الاستعلام لم يُولد

**الأسباب**:
- API غير مُكون
- اتصال مفقود
- سؤال غير مفهوم

**الحلول**:
- التحقق من تكوين API
- فحص الاتصال
- إعادة صياغة السؤال

### نتائج خاطئة

**الأسباب**:
- سؤال غامض
- حقل/جدول غير موجود

**الحلول**:
- كن أكثر تحديداً
- تحقق من أسماء الجداول/الحقول

### Ollama لا يستجيب

**الأسباب**:
- Ollama غير قيد التشغيل
- النموذج غير مُنزل

**الحلول**:
- تشغيل `ollama serve`
- تنزيل النموذج المطلوب

## المراجع

### الملفات المصدرية
- `modules/utility/textTosql.py` - فئة MakeSQL
- `modules/utility/database_schema.py` - مخطط قاعدة البيانات

### APIs الخارجية
- [OpenAI API](https://platform.openai.com/)
- [Ollama](https://ollama.ai/)

---

## فيديو تعليمي

### استعلام قاعدة البيانات بالذكاء الاصطناعي
`[فيديو مؤقت: video_ai_query.mp4]`

**المحتويات**:
- تكوين API
- كتابة أسئلة فعالة
- تفسير النتائج
- أفضل الممارسات

**المدة المتوقعة**: 15-18 دقيقة

---

*آخر تحديث: يناير 2026*
