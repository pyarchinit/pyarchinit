# الدرس 28: تصدير GeoPackage

## المقدمة

وظيفة **تصدير GeoPackage** تتيح تجميع الطبقات الموجهة والنقطية من PyArchInit في ملف GeoPackage واحد (.gpkg). هذه الصيغة مثالية للمشاركة والأرشفة وقابلية نقل بيانات GIS.

### مزايا GeoPackage

| الجانب | الميزة |
|--------|--------|
| ملف واحد | جميع البيانات في ملف واحد |
| قابلية النقل | مشاركة سهلة |
| معيار OGC | توافق عالمي |
| متعدد الطبقات | موجهة ونقطية معاً |
| قائم على SQLite | خفيف وسريع |

## الوصول

### من القائمة
**PyArchInit** ← **تجميع لـ GeoPackage**

## الواجهة

### لوحة التصدير

```
+--------------------------------------------------+
|        استيراد إلى GeoPackage                     |
+--------------------------------------------------+
| الوجهة:                                           |
|   [____________________________] [استعراض]       |
+--------------------------------------------------+
| [تصدير الطبقات الموجهة]                          |
| [تصدير الطبقات النقطية]                          |
+--------------------------------------------------+
```

## الإجراء

### تصدير الطبقات الموجهة

1. تحديد الطبقات للتصدير في لوحة طبقات QGIS
2. فتح أداة تصدير GeoPackage
3. تحديد مسار واسم ملف الوجهة
4. النقر على **"تصدير الطبقات الموجهة"**

### تصدير الطبقات النقطية

1. تحديد الطبقات النقطية في لوحة الطبقات
2. تحديد الوجهة (نفس الملف أو ملف جديد)
3. النقر على **"تصدير الطبقات النقطية"**

### التصدير المُجمع

لتضمين الموجهة والنقطية في نفس GeoPackage:
1. أولاً تصدير الموجهة
2. ثم تصدير النقطية في نفس الملف
3. النظام يضيف الطبقات إلى GeoPackage الموجود

## اختيار الطبقات

### الطريقة

1. في لوحة طبقات QGIS، تحديد الطبقات المطلوبة
   - Ctrl+نقر للتحديد المتعدد
   - Shift+نقر للنطاق
2. فتح تصدير GeoPackage
3. الطبقات المحددة سيتم تصديرها

### الطبقات الموصى بها

| الطبقة | النوع | ملاحظات |
|--------|-------|---------|
| pyunitastratigrafiche | موجهة | US إيداع |
| pyunitastratigrafiche_usm | موجهة | US جدارية |
| pyarchinit_quote | موجهة | نقاط المنسوب |
| pyarchinit_siti | موجهة | المواقع |
| الصورة الجوية | نقطية | صورة جوية للحفر |

## المخرجات

### بنية GeoPackage

```
output.gpkg
├── pyunitastratigrafiche (موجهة)
├── pyunitastratigrafiche_usm (موجهة)
├── pyarchinit_quote (موجهة)
└── ortofoto (نقطية)
```

### المسار الافتراضي

```
~/pyarchinit/pyarchinit_DB_folder/
```

## خيارات التصدير

### الطبقات الموجهة

- الحفاظ على الهندسات الأصلية
- حفظ جميع السمات
- تحويل الأسماء ذات المسافات تلقائياً (استخدام الشرطة السفلية)

### الطبقات النقطية

- دعم الصيغ الشائعة (GeoTIFF، إلخ)
- الحفاظ على الإسناد الجغرافي
- حفظ نظام المرجع

## الاستخدامات النموذجية

### مشاركة المشروع

```
1. تحديد جميع طبقات المشروع
2. التصدير إلى GeoPackage
3. مشاركة ملف .gpkg
4. المستلم يفتحه مباشرة في QGIS
```

### أرشفة الحملة

```
1. في نهاية الحملة، تحديد الطبقات النهائية
2. التصدير إلى GeoPackage مؤرخ
3. الأرشفة مع التوثيق
```

### النسخ الاحتياطي GIS

```
1. تصدير الحالة الحالية دورياً
2. الحفاظ على نسخ مؤرخة
3. استخدامها للاسترداد من الكوارث
```

## أفضل الممارسات

### 1. قبل التصدير

- التحقق من اكتمال الطبقات
- فحص نظام المرجع
- حفظ مشروع QGIS

### 2. التسمية

- استخدام أسماء وصفية للملف
- تضمين التاريخ في الاسم
- تجنب الأحرف الخاصة

### 3. التحقق

- فتح GeoPackage المُنشأ
- التحقق من وجود جميع الطبقات
- فحص السمات

## حل المشكلات

### فشل التصدير

**الأسباب**:
- طبقة غير صالحة
- مسار غير قابل للكتابة
- مساحة قرص غير كافية

**الحلول**:
- التحقق من صلاحية الطبقة
- فحص أذونات المجلد
- تحرير مساحة القرص

### طبقات مفقودة

**السبب**: الطبقة غير محددة

**الحل**: التحقق من التحديد في لوحة الطبقات

### النقطية لم تُصدر

**الأسباب**:
- صيغة غير مدعومة
- الملف المصدر غير قابل للوصول

**الحلول**:
- تحويل النقطية إلى GeoTIFF
- التحقق من مسار الملف المصدر

## المراجع

### الملفات المصدرية
- `tabs/gpkg_export.py` - واجهة التصدير
- `gui/ui/gpkg_export.ui` - تخطيط واجهة المستخدم

### التوثيق
- [معيار GeoPackage](https://www.geopackage.org/)
- [دعم GeoPackage في QGIS](https://docs.qgis.org/)

---

## فيديو تعليمي

### تصدير GeoPackage
`[فيديو مؤقت: video_geopackage.mp4]`

**المحتويات**:
- اختيار الطبقات
- تصدير الموجهة والنقطية
- التحقق من المخرجات
- أفضل الممارسات

**المدة المتوقعة**: 8-10 دقائق

---

*آخر تحديث: يناير 2026*
