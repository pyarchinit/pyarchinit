# الدرس 11: مصفوفة هاريس

## المقدمة

**مصفوفة هاريس** (أو المخطط الطبقي) هي أداة أساسية في علم الآثار لتمثيل العلاقات الطبقية بين الوحدات الطبقية المختلفة (US) بيانياً. يُنشئ PyArchInit مصفوفة هاريس تلقائياً من العلاقات الطبقية المُدخلة في بطاقات الوحدات الطبقية.

### ما هي مصفوفة هاريس؟

مصفوفة هاريس هي مخطط يُمثل:
- **التسلسل الزمني** للوحدات الطبقية (من الأحدث في الأعلى إلى الأقدم في الأسفل)
- **العلاقات المادية** بين الوحدات الطبقية (تغطي/مُغطاة بـ، تقطع/مقطوعة بـ، ترتبط بـ)
- **التأريخ** للحفر (التجميع حسب الفترات والمراحل)

### أنواع العلاقات المُمثلة

| العلاقة | المعنى | التمثيل |
|---------|--------|---------|
| تغطي/مُغطاة بـ | تراكب مادي | خط متصل للأسفل |
| تقطع/مقطوعة بـ | فعل سلبي (واجهة) | خط متقطع |
| ترتبط بـ/مماثلة لـ | معاصرة | خط أفقي ثنائي الاتجاه |
| تملأ/مملوءة بـ | ردم قطع | خط متصل |
| تستند إلى/مُستندة | استناد هيكلي | خط متصل |

## الوصول إلى الوظيفة

### من القائمة الرئيسية
1. **PyArchInit** في شريط القوائم
2. اختيار **مصفوفة هاريس**

### من بطاقة الوحدة الطبقية
1. فتح بطاقة الوحدة الطبقية
2. تبويب **الخريطة**
3. زر **"تصدير المصفوفة"** أو **"عرض المصفوفة"**

### المتطلبات المسبقة
- قاعدة البيانات متصلة بشكل صحيح
- وحدات طبقية مع علاقات طبقية مُكتملة
- تأريخ محدد (اختياري لكن مُوصى به)
- Graphviz مُثبت في النظام

## تكوين المصفوفة

### نافذة الإعدادات (Setting_Matrix)

قبل الإنشاء، تظهر نافذة تكوين:

#### تبويب عام

| الحقل | الوصف | القيمة المُوصى بها |
|-------|-------|-------------------|
| DPI | دقة الصورة | 150-300 |
| إظهار الفترات | تجميع الوحدات حسب الفترة/المرحلة | نعم |
| إظهار الأسطورة | تضمين الأسطورة في الرسم | نعم |

#### تبويب العقد "قبل/بعد" (العلاقات العادية)

| المعلمة | الوصف | الخيارات |
|---------|-------|----------|
| شكل العقدة | الشكل الهندسي | مربع، بيضاوي، معين |
| لون التعبئة | اللون الداخلي | أبيض، أزرق فاتح، إلخ. |
| النمط | مظهر الحدود | متصل، متقطع |
| سُمك الخط | عرض الحدود | 0.5 - 2.0 |
| نوع السهم | رأس السهم | عادي، معين، بدون |
| حجم السهم | حجم الرأس | 0.5 - 1.5 |

#### تبويب العقد "السلبية" (القطوعات)

| المعلمة | الوصف | الخيارات |
|---------|-------|----------|
| شكل العقدة | الشكل الهندسي | مربع، بيضاوي، معين |
| لون التعبئة | لون مميز | رمادي، أحمر فاتح |
| نمط الخط | مظهر الاتصال | متقطع |

#### تبويب العقد "المعاصرة"

| المعلمة | الوصف | الخيارات |
|---------|-------|----------|
| شكل العقدة | الشكل الهندسي | مربع، بيضاوي |
| لون التعبئة | لون مميز | أصفر فاتح، أبيض |
| نمط الخط | مظهر الاتصال | متصل |
| السهم | نوع الاتصال | بدون (ثنائي الاتجاه) |

## أنواع التصدير

### 1. تصدير المصفوفة القياسية

يُنشئ المصفوفة الأساسية مع:
- جميع العلاقات الطبقية
- التجميع حسب الفترة/المرحلة
- تخطيط عمودي (TB - من أعلى لأسفل)

**المخرجات**: `pyarchinit_Matrix_folder/Harris_matrix.jpg`

### 2. تصدير المصفوفة الموسعة (2ED)

نسخة موسعة مع:
- معلومات إضافية في العقد (الوحدة الطبقية + التعريف + التأريخ)
- اتصالات خاصة (>، >>)
- تصدير بصيغة GraphML أيضاً

**المخرجات**: `pyarchinit_Matrix_folder/Harris_matrix2ED.jpg`

### 3. عرض المصفوفة (عرض سريع)

للعرض السريع بدون خيارات تكوين:
- يستخدم الإعدادات الافتراضية
- إنشاء أسرع
- مثالي للمراجعات السريعة

## عملية الإنشاء

### الخطوة 1: جمع البيانات

يجمع النظام تلقائياً:
```
لكل وحدة طبقية في الموقع/المنطقة المحددة:
  - رقم الوحدة الطبقية
  - نوع الوحدة (US/USM)
  - العلاقات الطبقية
  - الفترة والمرحلة الأولية
  - التعريف التفسيري
```

### الخطوة 2: بناء الرسم البياني

إنشاء العلاقات:
```
التسلسل (قبل/بعد):
  US1 -> US2 (US1 تغطي US2)

السلبي (القطوعات):
  US3 -> US4 (US3 تقطع US4)

المعاصرة:
  US5 <-> US6 (US5 ترتبط بـ US6)
```

### الخطوة 3: التجميع حسب الفترات

تجميع هرمي:
```
الموقع
  └── المنطقة
      └── الفترة 1 : المرحلة 1 : "العصر الروماني"
          ├── US101
          ├── US102
          └── US103
      └── الفترة 1 : المرحلة 2 : "العصور القديمة المتأخرة"
          ├── US201
          └── US202
```

### الخطوة 4: الاختزال الانتقالي (tred)

يزيل أمر `tred` من Graphviz العلاقات المكررة:
- إذا US1 -> US2 و US2 -> US3، يزيل US1 -> US3
- يُبسط المخطط
- يحافظ فقط على العلاقات المباشرة

### الخطوة 5: العرض النهائي

إنشاء الصورة بصيغ متعددة:
- DOT (مصدر Graphviz)
- JPG (صورة مضغوطة)
- PNG (صورة بدون فقدان)

## تفسير المصفوفة

### القراءة العمودية

```
     [الوحدات الأحدث]
           ↓
        US 001
           ↓
        US 002
           ↓
        US 003
           ↓
     [الوحدات الأقدم]
```

### قراءة المجموعات

تُمثل المربعات الملونة الفترات/المراحل:
- **أزرق فاتح**: مجموعة الفترة
- **أصفر**: مجموعة المرحلة
- **رمادي**: خلفية الموقع

### أنواع الاتصالات

```
─────────→  خط متصل = تغطي/تملأ/تستند
- - - - →  خط متقطع = تقطع
←────────→  ثنائي الاتجاه = معاصرة/مماثلة
```

### ألوان العقد

| اللون | المعنى النموذجي |
|-------|----------------|
| أبيض | وحدة طبقية ترسب عادية |
| رمادي | وحدة طبقية سلبية (قطع) |
| أصفر | وحدات طبقية معاصرة |
| أزرق | وحدات بعلاقات خاصة |

## حل المشكلات

### خطأ: "اكتشاف حلقة"

**السبب**: توجد دورات في العلاقات (A تغطي B، B تغطي A)

**الحل**:
1. فتح بطاقة الوحدة الطبقية
2. التحقق من علاقات الوحدات المُشار إليها
3. تصحيح العلاقات الدورية
4. إعادة إنشاء المصفوفة

### خطأ: "أمر tred غير موجود"

**السبب**: Graphviz غير مُثبت

**الحل**:
- **Windows**: تثبيت Graphviz من graphviz.org
- **macOS**: `brew install graphviz`
- **Linux**: `sudo apt install graphviz`

### المصفوفة لم تُنشأ

**الأسباب المحتملة**:
1. لم تُدخل علاقات طبقية
2. وحدات بدون فترة/مرحلة معينة
3. مشاكل أذونات في مجلد المخرجات

**التحقق**:
1. التأكد من أن الوحدات لها علاقات
2. التحقق من التأريخ
3. التحقق من أذونات `pyarchinit_Matrix_folder`

### المصفوفة كبيرة جداً

**المشكلة**: صورة غير مقروءة مع كثير من الوحدات

**الحلول**:
1. تقليل DPI (100-150)
2. التصفية حسب منطقة محددة
3. استخدام عرض المصفوفة لمناطق فردية
4. التصدير بصيغة متجهة (DOT) وفتحها مع yEd

## ملفات المخرجات

### مجلد المخرجات

```
~/pyarchinit/pyarchinit_Matrix_folder/
├── Harris_matrix.dot           # مصدر Graphviz
├── Harris_matrix_tred.dot      # بعد الاختزال الانتقالي
├── Harris_matrix_tred.dot.jpg  # صورة نهائية JPG
├── Harris_matrix_tred.dot.png  # صورة نهائية PNG
├── Harris_matrix2ED.dot        # النسخة الموسعة
├── Harris_matrix2ED_graphml.dot # لتصدير GraphML
└── matrix_error.txt            # سجل الأخطاء
```

## أفضل الممارسات

### 1. قبل الإنشاء

- التحقق من اكتمال العلاقات الطبقية
- التأكد من عدم وجود دورات
- تعيين فترة/مرحلة لجميع الوحدات
- ملء التعريف التفسيري

### 2. أثناء ملء الوحدات الطبقية

- إدخال علاقات ثنائية الاتجاه صحيحة
- استخدام مصطلحات متسقة
- التحقق من المنطقة الصحيحة في العلاقات

### 3. تحسين المخرجات

- للطباعة: DPI 300
- للشاشة: DPI 150
- للحفريات المعقدة: التقسيم حسب المناطق

## التكامل مع أدوات أخرى

### التصدير لـ yEd

يمكن فتح ملف `_graphml.dot` في yEd لـ:
- تحرير التخطيط يدوياً
- إضافة تعليقات توضيحية
- التصدير بصيغ مختلفة

### التصدير لـ s3egraph

يدعم PyArchInit التصدير لنظام s3egraph:
- صيغة متوافقة
- يحافظ على العلاقات الطبقية
- دعم للعرض ثلاثي الأبعاد

## المراجع

### الملفات المصدرية
- `tabs/Interactive_matrix.py` - الواجهة التفاعلية
- `modules/utility/pyarchinit_matrix_exp.py` - فئات HarrisMatrix و ViewHarrisMatrix

### قاعدة البيانات
- `us_table` - بيانات الوحدات الطبقية والعلاقات
- `periodizzazione_table` - الفترات والمراحل

### التبعيات
- Graphviz (dot, tred)
- مكتبة Python graphviz

---

## فيديو تعليمي

### مصفوفة هاريس - إنشاء كامل
`[فيديو مؤقت: video_matrix_harris.mp4]`

**المحتويات**:
- تكوين الإعدادات
- إنشاء المصفوفة
- تفسير النتائج
- حل المشاكل الشائعة

**المدة المتوقعة**: 15-20 دقيقة

### مصفوفة هاريس - تحرير متقدم مع yEd
`[فيديو مؤقت: video_matrix_yed.mp4]`

**المحتويات**:
- التصدير لـ yEd
- تعديل التخطيط
- إضافة تعليقات
- إعادة التصدير

**المدة المتوقعة**: 10-12 دقيقة

---

*آخر تحديث: يناير 2026*

---

## رسوم متحركة تفاعلية

استكشف الرسوم المتحركة التفاعلية لمعرفة المزيد حول هذا الموضوع.

[افتح الرسوم المتحركة التفاعلية](../../animations/harris_matrix_animation.html)
