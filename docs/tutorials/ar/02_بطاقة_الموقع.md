# PyArchInit - بطاقة الموقع

## الفهرس
1. [المقدمة](#المقدمة)
2. [الوصول إلى البطاقة](#الوصول-إلى-البطاقة)
3. [واجهة المستخدم](#واجهة-المستخدم)
4. [البيانات الوصفية للموقع](#البيانات-الوصفية-للموقع)
5. [شريط أدوات DBMS](#شريط-أدوات-dbms)
6. [وظائف GIS](#وظائف-gis)
7. [إنشاء بطاقات الوحدات الطبقية](#إنشاء-بطاقات-الوحدات-الطبقية)
8. [MoveCost - تحليل المسارات](#movecost---تحليل-المسارات)
9. [تصدير التقارير](#تصدير-التقارير)
10. [سير العمل التشغيلي](#سير-العمل-التشغيلي)

---

## المقدمة

**بطاقة الموقع** هي نقطة البداية لتوثيق الحفريات الأثرية في PyArchInit. يبدأ كل مشروع أثري بإنشاء موقع، والذي يعمل كحاوية رئيسية لجميع المعلومات الأخرى (الوحدات الطبقية، الهياكل، القطع الأثرية، إلخ).

يمثل **الموقع الأثري** في PyArchInit منطقة جغرافية محددة تُجرى فيها أنشطة البحث الأثري. يمكن أن يكون حفرية، منطقة مسح، نصب تذكاري، إلخ.

> **فيديو تعليمي**: [رابط فيديو مقدمة بطاقة الموقع]

---

## الوصول إلى البطاقة

للوصول إلى بطاقة الموقع:

1. قائمة **PyArchInit** ← **Archaeological record management** ← **Site**
2. أو من شريط أدوات PyArchInit، انقر على أيقونة **الموقع**

![الوصول إلى بطاقة الموقع](images/02_site_form/01_menu_site.png)
*الشكل 1: الوصول إلى بطاقة الموقع من قائمة PyArchInit*

---

## واجهة المستخدم

بطاقة الموقع مقسمة إلى عدة مناطق وظيفية:

### المناطق الرئيسية

| # | المنطقة | الوصف |
|---|--------|--------|
| 1 | **شريط أدوات DBMS** | شريط أدوات للتنقل وإدارة السجلات |
| 2 | **البيانات الوصفية** | حقول لإدخال معلومات الموقع |
| 3 | **مولد الوحدات الطبقية** | أداة لإنشاء بطاقات الوحدات الطبقية بالجملة |
| 4 | **عارض GIS** | عناصر التحكم في العرض الخرائطي |
| 5 | **MoveCost** | أدوات التحليل المكاني المتقدم |
| 6 | **المساعدة** | التوثيق ومقاطع الفيديو التعليمية |

---

## البيانات الوصفية للموقع

### تبويب البيانات الوصفية

#### الحقول الإلزامية

| الحقل | الوصف | ملاحظات |
|-------|--------|---------|
| **الموقع** | الاسم التعريفي للموقع | حقل إلزامي، يجب أن يكون فريداً |

#### الحقول الجغرافية

| الحقل | الوصف | مثال |
|-------|--------|-------|
| **الدولة** | الدولة التي يقع فيها الموقع | مصر |
| **المنطقة** | المنطقة الإدارية | القاهرة الكبرى |
| **المحافظة** | المحافظة | الجيزة |
| **المدينة** | المدينة | الجيزة |

#### الحقول الوصفية

| الحقل | الوصف |
|-------|--------|
| **الاسم** | الاسم الكامل/الوصفي للموقع |
| **التعريف** | نوع الموقع (من القاموس) |
| **الوصف** | حقل نصي حر للوصف التفصيلي |
| **المجلد** | مسار مجلد المشروع المحلي |

### تعريف الموقع (القاموس)

يستخدم حقل **التعريف** مفردات متحكم بها (قاموس). الخيارات المتاحة تشمل:

| التعريف | الوصف |
|---------|--------|
| منطقة حفر | منطقة خاضعة للتحقيق الطبقي |
| منطقة مسح | منطقة مسح سطحي |
| موقع أثري | موقع به أدلة أثرية |
| نصب تذكاري | هيكل نصبي مفرد |
| مقبرة | منطقة دفن |
| مستوطنة | منطقة سكنية |
| معبد | منطقة مقدسة/عبادة |

### مجلد المشروع

يسمح حقل **المجلد** بربط دليل محلي بالموقع لتنظيم ملفات المشروع.

| الزر | الوظيفة |
|------|---------|
| **...** | تصفح لاختيار المجلد |
| **فتح** | فتح المجلد في مدير الملفات |

---

## شريط أدوات DBMS

يوفر شريط أدوات DBMS جميع عناصر التحكم لإدارة السجلات.

### مؤشرات الحالة

| المؤشر | الوصف |
|--------|--------|
| **DB Info** | يعرض نوع قاعدة البيانات المتصلة (SQLite/PostgreSQL) |
| **الحالة** | الحالة الحالية: `استخدام` (تصفح)، `بحث` (search)، `سجل جديد` |
| **الترتيب** | يشير إلى ما إذا كانت السجلات مرتبة |
| **سجل رقم** | رقم السجل الحالي |
| **إجمالي السجلات** | إجمالي السجلات |

### التنقل بين السجلات

| الزر | الأيقونة | الوظيفة |
|------|---------|---------|
| **First rec** | |< | الانتقال إلى السجل الأول |
| **Prev rec** | < | الانتقال إلى السجل السابق |
| **Next rec** | > | الانتقال إلى السجل التالي |
| **Last rec** | >| | الانتقال إلى السجل الأخير |

### إدارة السجلات

| الزر | الوظيفة | الوصف |
|------|---------|--------|
| **New record** | إنشاء جديد | تحضير النموذج لإدخال موقع جديد |
| **Save** | حفظ | حفظ التعديلات أو السجل الجديد |
| **Delete record** | حذف | حذف السجل الحالي (مع تأكيد) |
| **View all records** | عرض الكل | عرض جميع السجلات في قاعدة البيانات |

### البحث والترتيب

| الزر | الوظيفة | الوصف |
|------|---------|--------|
| **new search** | بحث جديد | بدء وضع البحث |
| **search !!!** | تنفيذ البحث | تنفيذ البحث بالمعايير المدخلة |
| **Order by** | ترتيب | فتح لوحة الترتيب |

#### كيفية إجراء بحث

1. انقر على **new search** - تتغير الحالة إلى "بحث"
2. أدخل معايير البحث في الحقول
3. انقر على **search !!!** للتنفيذ
4. يتم عرض النتائج ويمكنك التنقل بينها

---

## وظائف GIS

تقدم بطاقة الموقع عدة وظائف لتكامل GIS.

### تحميل الطبقات

| الزر | الوظيفة |
|------|---------|
| **GIS viewer** | تحميل جميع الطبقات لإدخال الأشكال الهندسية |
| **تحميل طبقة الموقع** | تحميل طبقات الموقع الحالي فقط |
| **تحميل جميع المواقع** | تحميل طبقات جميع المواقع |

### الترميز الجغرافي - البحث عن عنوان

تتيح وظيفة الترميز الجغرافي تحديد موقع عنوان على الخريطة.

1. أدخل العنوان في حقل النص
2. انقر على **Zoom on**
3. تتمركز الخريطة على الموقع المحدد

| الحقل | الوصف |
|-------|--------|
| **العنوان** | أدخل الشارع، المدينة، الدولة |
| **Zoom on** | تمركز الخريطة على العنوان |

### WMS القيود الأثرية

يحمل زر WMS طبقة القيود الأثرية (إن توفرت).

### خرائط الأساس

يسمح زر Base Maps بتحميل خرائط الأساس (Google Maps، OpenStreetMap، إلخ).

---

## إنشاء بطاقات الوحدات الطبقية

تتيح هذه الوظيفة إنشاء عدد من بطاقات الوحدات الطبقية تلقائياً للموقع الحالي.

### المعلمات

| الحقل | الوصف | مثال |
|-------|--------|-------|
| **رقم المنطقة** | رقم منطقة الحفر | 1 |
| **رقم بطاقة الوحدة الطبقية للبدء** | رقم البداية للوحدة الطبقية | 1 |
| **عدد البطاقات للإنشاء** | كم وحدة طبقية للإنشاء | 100 |
| **النوع** | US أو USM | US |

### الإجراء

1. تأكد من أنك في الموقع الصحيح
2. أدخل رقم المنطقة
3. أدخل رقم الوحدة الطبقية للبدء
4. أدخل عدد البطاقات للإنشاء
5. اختر النوع (US أو USM)
6. انقر على **إنشاء US**

---

## MoveCost - تحليل المسارات

يدمج قسم **MovecostToPyarchinit** وظائف R لتحليل مسارات أقل تكلفة (Least Cost Path Analysis).

### المتطلبات الأساسية

- **R** مثبت على النظام
- حزمة R **movecost** مثبتة
- إضافة **Processing R Provider** نشطة في QGIS

### الوظائف المتاحة

| الوظيفة | الوصف |
|---------|--------|
| **movecost** | حساب تكلفة الحركة ومسارات أقل تكلفة من نقطة المنشأ |
| **movecost by polygon** | نفس السابق، باستخدام مضلع لتنزيل DTM |
| **movebound** | حساب حدود تكلفة المشي حول النقاط |
| **movcorr** | حساب ممرات أقل تكلفة بين النقاط |
| **movalloc** | تخصيص إقليمي بناءً على التكاليف |

### إضافة السكريبتات

يقوم زر **Add scripts** بتثبيت سكريبتات R اللازمة تلقائياً في ملف تعريف QGIS.

---

## تصدير التقارير

### تصدير تقرير الحفر

ينشئ زر **تصدير** ملف PDF بتقرير الحفر للموقع الحالي.

**ملاحظة**: هذه الوظيفة في إصدار التطوير وقد تحتوي على أخطاء.

يتضمن التقرير:
- بيانات تعريف الموقع
- قائمة الوحدات الطبقية
- التسلسل الطبقي
- مصفوفة هاريس (إن توفرت)

---

## سير العمل التشغيلي

### إنشاء موقع جديد

#### الخطوة 1: فتح بطاقة الموقع

#### الخطوة 2: انقر على "New record"
تتغير الحالة إلى "سجل جديد" وتفرغ الحقول.

#### الخطوة 3: أدخل البيانات الإلزامية
أدخل على الأقل اسم الموقع (حقل إلزامي).

#### الخطوة 4: أدخل البيانات الجغرافية
أدخل الدولة، المنطقة، المحافظة، المدينة.

#### الخطوة 5: اختر التعريف
اختر نوع الموقع من القاموس.

#### الخطوة 6: أضف الوصف
أدخل معلومات تفصيلية في حقل الوصف.

#### الخطوة 7: الحفظ
انقر على **Save** لحفظ الموقع الجديد.

#### الخطوة 8: التحقق
تم إنشاء الموقع، تعود الحالة إلى "استخدام".

### تعديل موقع موجود

1. انتقل إلى الموقع المراد تعديله
2. عدّل الحقول المطلوبة
3. انقر على **Save**
4. أكد حفظ التعديلات

### حذف موقع

**تحذير**: حذف موقع لا يحذف تلقائياً الوحدات الطبقية والهياكل والقطع المرتبطة.

1. انتقل إلى الموقع المراد حذفه
2. انقر على **Delete record**
3. أكد الحذف

---

## إدارة التزامن (PostgreSQL)

عند استخدام PostgreSQL في بيئة متعددة المستخدمين، يدير النظام تلقائياً تعارضات التعديل:

- **مؤشر القفل**: يظهر إذا كان السجل قيد التعديل من مستخدم آخر
- **التحكم في الإصدار**: يكتشف التعديلات المتزامنة
- **حل التعارضات**: يسمح باختيار الإصدار الذي سيُحتفظ به

---

## حل المشكلات

### الموقع لا يُحفظ
- تحقق من أن حقل "الموقع" مكتمل
- تحقق من أن الاسم غير موجود بالفعل في قاعدة البيانات

### طبقات GIS لا تُحمّل
- تحقق من الاتصال بقاعدة البيانات
- تحقق من وجود أشكال هندسية مرتبطة بالموقع

### خطأ في الترميز الجغرافي
- تحقق من اتصال الإنترنت
- تحقق من كتابة العنوان بشكل صحيح

### MoveCost لا يعمل
- تحقق من تثبيت R
- تحقق من تفعيل إضافة Processing R Provider
- ثبّت حزمة movecost في R

---

## ملاحظات تقنية

- **جدول قاعدة البيانات**: `site_table`
- **حقول قاعدة البيانات**: sito, nazione, regione, comune, descrizione, provincia, definizione_sito, sito_path
- **طبقات GIS المرتبطة**: PYSITO_POLYGON, PYSITO_POINT
- **القاموس**: tipologia_sigla = '1.1'

---

*توثيق PyArchInit - بطاقة الموقع*
*الإصدار: 4.9.x*
*آخر تحديث: يناير 2026*
