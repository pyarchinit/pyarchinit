# PyArchInit - دليل التكوين

## الفهرس
1. [المقدمة](#المقدمة)
2. [الوصول إلى التكوين](#الوصول-إلى-التكوين)
3. [تبويب معلمات الاتصال](#تبويب-معلمات-الاتصال)
4. [تبويب تثبيت قاعدة البيانات](#تبويب-تثبيت-قاعدة-البيانات)
5. [تبويب أدوات الاستيراد](#تبويب-أدوات-الاستيراد)
6. [تبويب Graphviz](#تبويب-graphviz)
7. [تبويب PostgreSQL](#تبويب-postgresql)
8. [تبويب المساعدة](#تبويب-المساعدة)
9. [تبويب FTP إلى Lizmap](#تبويب-ftp-إلى-lizmap)

---

## المقدمة

تتيح نافذة تكوين PyArchInit ضبط جميع المعلمات اللازمة لتشغيل الإضافة بشكل صحيح. قبل البدء في توثيق الحفريات الأثرية، من الضروري تكوين الاتصال بقاعدة البيانات ومسارات الموارد بشكل صحيح.

> **فيديو تعليمي**: [رابط فيديو مقدمة التكوين]

---

## الوصول إلى التكوين

للوصول إلى التكوين:
1. فتح QGIS
2. قائمة **PyArchInit** ← **Config**

أو من شريط أدوات PyArchInit انقر على أيقونة **الإعدادات**.

![الوصول إلى التكوين](images/01_configuration/01_menu_config.png)
*الشكل 1: الوصول إلى نافذة التكوين من قائمة PyArchInit*

---

## تبويب معلمات الاتصال

هذه هي الصفحة الرئيسية لتكوين الاتصال بقاعدة البيانات.

### قسم إعدادات قاعدة البيانات

| الحقل | الوصف |
|-------|--------|
| **Database** | اختر نوع قاعدة البيانات: `sqlite` (محلية) أو `postgres` (خادم) |
| **Host** | عنوان خادم PostgreSQL (مثل `localhost` أو عنوان IP) |
| **DBname** | اسم قاعدة البيانات (مثل `pyarchinit`) |
| **Port** | منفذ الاتصال (افتراضي: `5432` لـ PostgreSQL) |
| **User** | اسم المستخدم للاتصال |
| **Password** | كلمة مرور المستخدم |
| **SSL Mode** | وضع SSL لـ PostgreSQL: `allow`، `prefer`، `require`، `disable` |

#### اختيار قاعدة البيانات

**SQLite/Spatialite** (موصى به للاستخدام الفردي):
- قاعدة بيانات محلية، لا حاجة لخادم
- مثالية للمشاريع الفردية أو الصغيرة
- يتم حفظ ملف `.sqlite` في مجلد `pyarchinit_DB_folder`

**PostgreSQL/PostGIS** (موصى به للفرق):
- قاعدة بيانات على خادم، وصول متعدد المستخدمين
- يتطلب تثبيت PostgreSQL مع امتداد PostGIS
- يدعم إدارة المستخدمين والأذونات
- مثالي للمشاريع الكبيرة مع عدة مشغلين

### قسم إعدادات المسارات

| الحقل | الوصف | الزر |
|-------|--------|------|
| **Thumbnail path** | مسار حفظ الصور المصغرة | `...` للتصفح |
| **Image resize** | مسار الصور المعاد تحجيمها | `...` للتصفح |
| **Logo path** | مسار الشعار المخصص للتقارير | `...` للتصفح |

#### المسارات البعيدة المدعومة

يدعم PyArchInit التخزين البعيد:
- **Google Drive**: `gdrive://folder/path/`
- **Dropbox**: `dropbox://folder/path/`
- **Amazon S3**: `s3://bucket/path/`
- **Cloudinary**: `cloudinary://cloud_name/folder/`
- **WebDAV**: `webdav://server/path/`
- **HTTP/HTTPS**: `https://server/path/`

### قسم تفعيل الموقع

| الحقل | الوصف |
|-------|--------|
| **تفعيل استعلام الموقع** | اختر الموقع النشط لتصفية البيانات في البطاقات |

هذا الخيار أساسي عند العمل مع عدة مواقع أثرية في نفس قاعدة البيانات.

### أزرار العمل

| الزر | الوظيفة |
|------|---------|
| **حفظ المعلمات** | حفظ جميع الإعدادات المكونة |
| **تحديث قاعدة البيانات** | تحديث مخطط قاعدة البيانات الموجودة دون فقدان البيانات |

### وظائف محاذاة قاعدة البيانات

| الزر | الوصف |
|------|--------|
| **محاذاة Postgres** | محاذاة وتحديث هيكل قاعدة بيانات PostgreSQL |
| **محاذاة Spatialite** | محاذاة وتحديث هيكل قاعدة بيانات SQLite |
| **EPSG code** | أدخل رمز EPSG للنظام المرجعي لقاعدة البيانات |

---

## تبويب تثبيت قاعدة البيانات

تتيح هذه الصفحة إنشاء قاعدة بيانات جديدة من الصفر.

### تثبيت قاعدة البيانات (PostgreSQL/PostGIS)

| الحقل | الوصف |
|-------|--------|
| **host** | عنوان الخادم (افتراضي: `localhost`) |
| **port (5432)** | منفذ خادم PostgreSQL |
| **user** | مستخدم بأذونات إنشاء قاعدة البيانات (مثل `postgres`) |
| **password** | كلمة مرور المستخدم |
| **db name** | اسم قاعدة البيانات الجديدة (افتراضي: `pyarchinit`) |
| **اختر SRID** | النظام المرجعي المكاني (مثل `4326` لـ WGS84) |

**زر التثبيت**: ينشئ قاعدة البيانات مع جميع الجداول اللازمة.

### تثبيت قاعدة البيانات (SpatiaLite)

| الحقل | الوصف |
|-------|--------|
| **db name** | اسم ملف قاعدة البيانات (افتراضي: `pyarchinit`) |
| **اختر SRID** | النظام المرجعي المكاني |

### أكواد SRID الشائعة

| SRID | الوصف |
|------|--------|
| 4326 | WGS 84 (إحداثيات جغرافية) |
| 32632 | WGS 84 / UTM zone 32N |
| 32633 | WGS 84 / UTM zone 33N |
| 32636 | WGS 84 / UTM zone 36N (الشرق الأوسط) |
| 32637 | WGS 84 / UTM zone 37N (الشرق الأوسط) |

---

## تبويب أدوات الاستيراد

تتيح هذه الصفحة استيراد البيانات من قواعد بيانات أخرى أو ملفات CSV.

### قسم استيراد البيانات

#### قاعدة البيانات المصدر

| الحقل | الوصف |
|-------|--------|
| **Database** | نوع قاعدة البيانات المصدر (`sqlite` أو `postgres`) |
| **Host/Port/Username/Password** | بيانات اعتماد PostgreSQL المصدر |
| **...** | اختر ملف SQLite المصدر |

#### قاعدة البيانات الوجهة

| الحقل | الوصف |
|-------|--------|
| **Database** | نوع قاعدة البيانات الوجهة |
| **Host/Port/Username/Password** | بيانات اعتماد PostgreSQL الوجهة |
| **...** | اختر ملف SQLite الوجهة |

### الجداول المتاحة للاستيراد

| الجدول | الوصف |
|--------|--------|
| SITE | المواقع الأثرية |
| US | الوحدات الطبقية |
| PERIODIZZAZIONE | التأريخ والمراحل |
| INVENTARIO_MATERIALI | جرد القطع الأثرية |
| POTTERY | الفخار |
| STRUTTURA | الهياكل |
| TOMBA | القبور |
| SCHEDAIND | بطاقات الأفراد |
| ARCHEOZOOLOGY | بيانات علم آثار الحيوان |
| CAMPIONI | العينات |
| DOCUMENTAZIONE | التوثيق |
| MEDIA | ملفات الوسائط |
| ALL | جميع الجداول |

### خيارات الاستيراد

| الخيار | الوصف |
|--------|--------|
| **Replace** | استبدال السجلات الموجودة |
| **Ignore** | تجاهل التكرارات |
| **Abort** | التوقف في حالة الخطأ |

### استيراد الأشكال الهندسية

| الطبقة | الوصف |
|--------|--------|
| PYSITO_POLYGON | مضلعات المواقع |
| PYSITO_POINT | نقاط المواقع |
| PYUS | الوحدات الطبقية |
| PYUSM | الوحدات الطبقية الجدارية |
| PYQUOTE | الارتفاعات |
| PYSTRUTTURE | الهياكل |
| PYREPERTI | القطع الأثرية |
| PYINDIVIDUI | الأفراد |
| PYTOMBA | القبور |

---

## تبويب Graphviz

Graphviz ضروري لإنشاء مخططات مصفوفة هاريس.

### التكوين

| الحقل | الوصف |
|-------|--------|
| **مسار bin** | مسار مجلد `/bin` لـ Graphviz |
| **...** | تصفح لاختيار المجلد |
| **حفظ** | حفظ المسار في متغير البيئة PATH |

### تثبيت Graphviz

**Windows**: تنزيل من https://graphviz.org/download/ وتثبيت

**macOS**:
```bash
brew install graphviz
```

**Linux (Ubuntu/Debian)**:
```bash
sudo apt-get install graphviz
```

---

## تبويب PostgreSQL

تكوين مسار PostgreSQL للعمليات المتقدمة.

| الحقل | الوصف |
|-------|--------|
| **مسار bin** | مسار مجلد `/bin` لـ PostgreSQL |
| **...** | تصفح لاختيار المجلد |
| **حفظ** | حفظ المسار في متغير البيئة PATH |

ضروري لعمليات مثل النسخ الاحتياطي والاستعادة.

---

## تبويب المساعدة

يحتوي على موارد المساعدة والتوثيق.

### روابط مفيدة

| المورد | الوصف |
|--------|--------|
| **فيديوهات تعليمية** | روابط لفيديوهات YouTube التعليمية |
| **التوثيق عبر الإنترنت** | https://pyarchinit.github.io/pyarchinit_doc/index.html |

---

## تبويب FTP إلى Lizmap

يتيح نشر البيانات على خادم Lizmap للعرض على الويب.

### معلمات اتصال FTP

| الحقل | الوصف |
|-------|--------|
| **عنوان IP** | عنوان IP لخادم FTP |
| **Port** | منفذ FTP (افتراضي: 21) |
| **User** | اسم مستخدم FTP |
| **Password** | كلمة مرور FTP |

### العمليات المتاحة

| الزر | الوظيفة |
|------|---------|
| **Connect** | الاتصال بخادم FTP |
| **Disconnect** | قطع الاتصال |
| **Change directory** | تغيير الدليل الحالي |
| **Create Directory** | إنشاء دليل جديد |
| **Upload file** | رفع ملف إلى الخادم |
| **Download file** | تنزيل ملف من الخادم |
| **Delete file** | حذف ملف |
| **Delete directory** | حذف دليل |

---

## سير العمل الموصى به لمشروع جديد

1. **فتح التكوين** من قائمة PyArchInit

2. **اختيار نوع قاعدة البيانات** (SQLite للاستخدام الفردي، PostgreSQL للفرق)

3. **تبويب تثبيت قاعدة البيانات**: إنشاء قاعدة بيانات جديدة بـ SRID المناسب

4. **تبويب معلمات الاتصال**: تكوين معلمات الاتصال

5. **تعيين المسارات** للصور المصغرة والتحجيم والشعار

6. **حفظ المعلمات**

7. **اختبار الاتصال** بفتح أي بطاقة (مثل الموقع)

---

## حل المشكلات الشائعة

### خطأ في اتصال PostgreSQL

- تحقق من تشغيل خادم PostgreSQL
- تحقق من المضيف والمنفذ وبيانات الاعتماد
- تحقق من تثبيت امتداد PostGIS

### قاعدة بيانات SQLite غير موجودة

- تحقق من وجود الملف في مجلد `pyarchinit_DB_folder`
- تحقق من أذونات القراءة/الكتابة

### Graphviz لا يعمل

- تحقق من تثبيت Graphviz
- اضبط المسار يدوياً في تبويب Graphviz
- أعد تشغيل QGIS بعد التكوين

### الصور غير معروضة

- تحقق من مسارات Thumbnail path وImage resize
- تحقق من وجود المجلدات وإمكانية الوصول إليها

---

## ملاحظات تقنية

- يتم حفظ الإعدادات في QgsSettings لـ QGIS
- قاعدة البيانات الافتراضية هي `Home/pyarchinit/pyarchinit_DB_folder/pyarchinit_db.sqlite`
- يتم حفظ سجلات التصحيح في `[TEMP]/pyarchinit_debug.log`

---

*توثيق PyArchInit - بطاقة التكوين*
*الإصدار: 4.9.x*
*آخر تحديث: يناير 2026*
