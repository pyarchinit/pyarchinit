# الدرس 12: التقارير وطباعة PDF

## المقدمة

يوفر PyArchInit نظاماً كاملاً لإنشاء **تقارير PDF** لجميع البطاقات الأثرية. تتيح هذه الوظيفة تصدير التوثيق بصيغة قابلة للطباعة، متوافقة مع المعايير الوزارية وجاهزة للأرشفة.

### أنواع التقارير المتاحة

| النوع | الوصف | البطاقة المصدرية |
|-------|-------|-----------------|
| بطاقات الوحدات الطبقية | تقارير كاملة US/USM | بطاقة الوحدة الطبقية |
| فهرس الوحدات الطبقية | قائمة موجزة | بطاقة الوحدة الطبقية |
| بطاقات التأريخ | تقارير الفترات/المراحل | بطاقة التأريخ |
| بطاقات الهياكل | تقارير الهياكل | بطاقة الهيكل |
| بطاقات القطع | تقارير جرد المواد | بطاقة الجرد |
| بطاقات القبور | تقارير المدافن | بطاقة القبر |
| بطاقات العينات | تقارير العينات | بطاقة العينات |
| بطاقات الأفراد | تقارير الأنثروبولوجيا | بطاقة الأفراد |

## الوصول إلى الوظيفة

### من القائمة الرئيسية
1. **PyArchInit** في شريط القوائم
2. اختيار **تصدير PDF**

### من شريط الأدوات
النقر على أيقونة **PDF** في شريط أدوات PyArchInit

## واجهة التصدير

### نظرة عامة على النافذة

تعرض نافذة تصدير PDF:

```
+------------------------------------------+
|        PyArchInit - تصدير PDF             |
+------------------------------------------+
| الموقع: [قائمة منسدلة اختيار الموقع] [v]  |
+------------------------------------------+
| البطاقات للتصدير:                          |
| [x] بطاقات الوحدات الطبقية                 |
| [x] بطاقات التأريخ                         |
| [x] بطاقات الهياكل                         |
| [x] بطاقات القطع                           |
| [x] بطاقات القبور                          |
| [x] بطاقات العينات                         |
| [x] بطاقات الأفراد                         |
+------------------------------------------+
| [فتح المجلد]  [تصدير PDF]  [إلغاء]          |
+------------------------------------------+
```

### اختيار الموقع

| الحقل | الوصف |
|-------|-------|
| قائمة الموقع | قائمة جميع المواقع في قاعدة البيانات |

**ملاحظة**: يتم التصدير لموقع واحد. لتصدير عدة مواقع، كرر العملية.

### خانات اختيار البطاقات

كل خانة تُفعل تصدير نوع محدد:

| الخانة | يُنشئ |
|--------|-------|
| بطاقات الوحدات الطبقية | بطاقات كاملة + فهرس |
| بطاقات التأريخ | بطاقات الفترات + فهرس |
| بطاقات الهياكل | بطاقات الهياكل + فهرس |
| بطاقات القطع | بطاقات المواد + فهرس |
| بطاقات القبور | بطاقات المدافن + فهرس |
| بطاقات العينات | بطاقات العينات + فهرس |
| بطاقات الأفراد | بطاقات الأنثروبولوجيا + فهرس |

## عملية التصدير

### الخطوة 1: اختيار البيانات

```
# يُنفذ النظام لكل نوع محدد:
1. استعلام قاعدة البيانات للموقع المحدد
2. ترتيب البيانات (حسب الرقم، المنطقة، إلخ.)
3. تحضير القائمة للإنشاء
```

### الخطوة 2: إنشاء PDF

لكل نوع بطاقة:
1. **بطاقة مفردة**: PDF مفصل لكل سجل
2. **فهرس**: PDF ملخص بجميع السجلات

### الخطوة 3: الحفظ

المخرجات في المجلد:
```
~/pyarchinit/pyarchinit_PDF_folder/
```

## محتوى التقارير

### بطاقة الوحدة الطبقية

المعلومات المتضمنة:
- **بيانات التعريف**: الموقع، المنطقة، رقم الوحدة، نوع الوحدة
- **التعريفات**: الطبقي، التفسيري
- **الوصف**: النص الوصفي الكامل
- **التفسير**: التحليل التفسيري
- **التأريخ**: الفترة/المرحلة الأولية والنهائية
- **الخصائص المادية**: اللون، القوام، التكوين
- **القياسات**: الارتفاعات دنيا/قصوى، الأبعاد
- **العلاقات**: قائمة العلاقات الطبقية
- **التوثيق**: مراجع رسومية وفوتوغرافية
- **بيانات USM**: (إن وُجد) تقنية البناء، المواد

### فهرس الوحدات الطبقية

جدول ملخص بأعمدة:
| الموقع | المنطقة | الوحدة | التعريف الطبقي | التعريف التفسيري | الفترة |

### بطاقة التأريخ

- الموقع
- رقم الفترة
- رقم المرحلة
- التسلسل الزمني الأولي/النهائي
- التأريخ الموسع
- وصف الفترة

### بطاقة الهيكل

- بيانات التعريف (الموقع، الرمز، الرقم)
- الفئة، النمط، التعريف
- الوصف والتفسير
- التأريخ
- المواد المستخدمة
- العناصر الهيكلية
- علاقات الهيكل
- القياسات والارتفاعات

### بطاقة القطع

- الموقع، رقم الجرد
- نوع القطعة، التعريف
- الوصف
- المصدر (المنطقة، الوحدة الطبقية)
- حالة الحفظ
- التأريخ
- العناصر والقياسات
- الببليوغرافيا

### بطاقة القبر

- بيانات التعريف
- الطقس (دفن/حرق)
- نوع المدفن والدفن
- الوصف والتفسير
- الأثاث الجنائزي (الوجود، النوع، الوصف)
- التأريخ
- ارتفاعات الهيكل والفرد
- الوحدات الطبقية المرتبطة

### بطاقة العينات

- الموقع، رقم العينة
- نوع العينة
- الوصف
- المصدر (المنطقة، الوحدة الطبقية)
- مكان الحفظ
- رقم الصندوق

### بطاقة الأفراد

- بيانات التعريف
- الجنس، العمر (أدنى/أقصى)، فئات العمر
- وضعية الهيكل
- الاتجاه (المحور، السمت)
- حالة الحفظ
- الملاحظات

## اللغات المدعومة

يُنشئ النظام تقارير بناءً على لغة النظام:

| اللغة | الرمز | القالب |
|-------|-------|--------|
| الإيطالية | IT | `build_*_sheets()` |
| الألمانية | DE | `build_*_sheets_de()` |
| الإنجليزية | EN | `build_*_sheets_en()` |

يُكتشف اللغة تلقائياً من إعدادات QGIS.

## مجلد المخرجات

### المسار القياسي
```
~/pyarchinit/pyarchinit_PDF_folder/
```

### بنية الملفات المُنشأة

```
pyarchinit_PDF_folder/
├── US_[الموقع]_بطاقات.pdf           # بطاقات الوحدات الكاملة
├── US_[الموقع]_فهرس.pdf            # فهرس الوحدات
├── التأريخ_[الموقع].pdf            # بطاقات التأريخ
├── الهياكل_[الموقع]_بطاقات.pdf     # بطاقات الهياكل
├── الهياكل_[الموقع]_فهرس.pdf       # فهرس الهياكل
├── القطع_[الموقع]_بطاقات.pdf       # بطاقات القطع
├── القطع_[الموقع]_فهرس.pdf         # فهرس القطع
├── القبور_[الموقع]_بطاقات.pdf      # بطاقات القبور
├── العينات_[الموقع]_بطاقات.pdf     # بطاقات العينات
├── الأفراد_[الموقع]_بطاقات.pdf     # بطاقات الأفراد
└── ...
```

### فتح المجلد

زر **"فتح المجلد"** يفتح مباشرة دليل المخرجات في مدير الملفات.

## تخصيص التقارير

### قوالب PDF

القوالب محددة في الوحدات:
- `modules/utility/pyarchinit_exp_USsheet_pdf.py`
- `modules/utility/pyarchinit_exp_Findssheet_pdf.py`
- `modules/utility/pyarchinit_exp_Periodizzazionesheet_pdf.py`
- `modules/utility/pyarchinit_exp_Individui_pdf.py`
- `modules/utility/pyarchinit_exp_Strutturasheet_pdf.py`
- `modules/utility/pyarchinit_exp_Tombasheet_pdf.py`
- `modules/utility/pyarchinit_exp_Campsheet_pdf.py`

### المكتبة المستخدمة

تُنشأ ملفات PDF باستخدام **ReportLab**، التي تتيح:
- تخطيطات مخصصة
- إدراج صور
- جداول منسقة
- رؤوس/تذييلات صفحات

### الخطوط المطلوبة

يستخدم النظام خطوطاً محددة:
- **Cambria** (الخط الرئيسي)
- التثبيت التلقائي عند أول تشغيل للإضافة

## سير العمل الموصى به

### 1. تحضير البيانات

```
1. إكمال جميع بطاقات الموقع
2. التحقق من اكتمال البيانات
3. التحقق من التأريخ
4. التحقق من العلاقات الطبقية
```

### 2. التصدير

```
1. فتح تصدير PDF
2. اختيار الموقع
3. اختيار أنواع البطاقات
4. النقر على "تصدير PDF"
5. انتظار الاكتمال
```

### 3. التحقق

```
1. فتح مجلد المخرجات
2. التحقق من ملفات PDF المُنشأة
3. التحقق من التنسيق
4. طباعة أو أرشفة
```

## حل المشكلات

### خطأ: "لا يوجد نموذج للطباعة"

**السبب**: لم يُعثر على سجلات للنوع المحدد

**الحل**:
- التحقق من وجود بيانات للموقع المحدد
- التحقق من قاعدة البيانات

### PDF فارغة أو غير مكتملة

**الأسباب المحتملة**:
1. حقول إلزامية غير مملوءة
2. مشاكل ترميز الأحرف
3. خطوط مفقودة

**الحلول**:
- إكمال الحقول الإلزامية
- التحقق من تثبيت خط Cambria

### خطأ الخط

**السبب**: خط Cambria غير مُثبت

**الحل**:
- تحاول الإضافة التثبيت التلقائي
- في حالة المشاكل، التثبيت يدوياً

### التصدير بطيء

**السبب**: سجلات كثيرة للتصدير

**الحل**:
- التصدير حسب النوع بشكل منفصل
- انتظار الاكتمال

## أفضل الممارسات

### 1. التنظيم

- التصدير بانتظام أثناء الحفر
- إنشاء نسخ احتياطية من ملفات PDF
- التنظيم حسب الموسم/السنة

### 2. اكتمال البيانات

- ملء جميع الحقول قبل التصدير
- التحقق من الارتفاعات من قياسات GIS
- التحقق من العلاقات الطبقية

### 3. الأرشفة

- حفظ PDF في تخزين آمن
- التضمين في التوثيق النهائي
- إرفاق بتقرير الحفر

### 4. الطباعة

- استخدام ورق خالي من الحمض للأرشفة
- الطباعة بحجم A4
- التجليد حسب الموسم

## التكامل مع وظائف أخرى

### الارتفاعات من GIS

يسترجع النظام تلقائياً:
- الارتفاعات الدنيا والقصوى من الهندسات
- مراجع خطط GIS

### التوثيق الفوتوغرافي

يمكن أن تتضمن التقارير مراجع لـ:
- الصور المرتبطة
- الرسومات والمرفوعات

### التأريخ

تتضمن تقارير الوحدات الطبقية تلقائياً:
- التأريخ الموسع من الفترة/المرحلة المعينة
- مراجع زمنية

## المراجع

### الملفات المصدرية
- `tabs/Pdf_export.py` - واجهة التصدير
- `modules/utility/pyarchinit_exp_*_pdf.py` - مُنشئات PDF

### التبعيات
- ReportLab (إنشاء PDF)
- خط Cambria

---

## فيديو تعليمي

### تصدير PDF كامل
`[فيديو مؤقت: video_export_pdf.mp4]`

**المحتويات**:
- اختيار الموقع والبطاقات
- عملية التصدير
- التحقق من المخرجات
- تنظيم الأرشيف

**المدة المتوقعة**: 10-12 دقيقة

---

*آخر تحديث: يناير 2026*
