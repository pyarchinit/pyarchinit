# دليل 05: بطاقة الهيكل

## المقدمة

**بطاقة الهيكل** هي وحدة PyArchInit المخصصة لتوثيق الهياكل الأثرية. الهيكل هو مجموعة منظمة من الوحدات الطبقية (US/USM) التي تشكل كياناً بنائياً أو وظيفياً يمكن التعرف عليه، مثل جدار، رصيف، قبر، فرن، أو أي عنصر مبني آخر.

### المفاهيم الأساسية

**الهيكل مقابل الوحدة الطبقية:**
- **الوحدة الطبقية** هي الوحدة المفردة (طبقة، قطع، ملء)
- **الهيكل** يجمع عدة وحدات طبقية مترابطة وظيفياً
- مثال: الجدار (هيكل) يتكون من الأساس، المرتفع، الملاط (وحدات طبقية مختلفة)

**التسلسلات الهرمية:**
- يمكن أن يكون للهياكل علاقات فيما بينها
- ينتمي كل هيكل إلى فترة/مرحلة زمنية واحدة أو أكثر
- ترتبط الهياكل بالوحدات الطبقية التي تتكون منها

---

## الوصول إلى البطاقة

### عبر القائمة
1. قائمة **PyArchInit** في شريط قوائم QGIS
2. اختر **Gestione Strutture** (أو **Structure form**)

### عبر شريط الأدوات
1. حدد شريط أدوات PyArchInit
2. انقر على أيقونة **الهيكل** (مبنى منمق)

---

## نظرة عامة على الواجهة

تقدم البطاقة تخطيطاً منظماً في أقسام وظيفية:

### المناطق الرئيسية

| # | المنطقة | الوصف |
|---|--------|--------|
| 1 | شريط أدوات DBMS | التنقل، البحث، الحفظ |
| 2 | معلومات قاعدة البيانات | حالة السجل، الترتيب، العداد |
| 3 | الحقول التعريفية | الموقع، الرمز، رقم الهيكل |
| 4 | حقول التصنيف | الفئة، النوع، التعريف |
| 5 | منطقة التبويبات | تبويبات موضوعية لبيانات محددة |

---

## شريط أدوات DBMS

يوفر شريط الأدوات الرئيسي جميع الأدوات لإدارة السجلات.

### أزرار التنقل

| الأيقونة | الوظيفة | الوصف |
|----------|---------|--------|
| |< | First rec | الانتقال إلى السجل الأول |
| < | Prev rec | الانتقال إلى السجل السابق |
| > | Next rec | الانتقال إلى السجل التالي |
| >| | Last rec | الانتقال إلى السجل الأخير |

### أزرار CRUD

| الوظيفة | الوصف |
|---------|--------|
| New record | إنشاء سجل هيكل جديد |
| Save | حفظ التعديلات |
| Delete | حذف السجل الحالي |

### أزرار البحث

| الوظيفة | الوصف |
|---------|--------|
| New search | بدء بحث جديد |
| Search!!! | تنفيذ البحث |
| Order by | ترتيب النتائج |
| View all | عرض جميع السجلات |

### الأزرار الخاصة

| الوظيفة | الوصف |
|---------|--------|
| Map preview | تفعيل/إلغاء معاينة الخريطة |
| Media preview | تفعيل/إلغاء معاينة الوسائط |
| Draw structure | رسم الهيكل على الخريطة |
| Load to GIS | تحميل الهيكل على الخريطة |
| Load all | تحميل جميع الهياكل |
| PDF export | التصدير إلى PDF |
| Open directory | فتح مجلد التصدير |

---

## الحقول التعريفية

الحقول التعريفية تحدد الهيكل بشكل فريد في قاعدة البيانات.

### الموقع

**الحقل**: `comboBox_sito`
**قاعدة البيانات**: `sito`

يختار الموقع الأثري الذي ينتمي إليه. تعرض القائمة المنسدلة جميع المواقع المسجلة في قاعدة البيانات.

**ملاحظات:**
- حقل إلزامي
- يجب أن تكون مجموعة الموقع + الرمز + الرقم فريدة
- مقفل بعد إنشاء السجل

### رمز الهيكل

**الحقل**: `comboBox_sigla_struttura`
**قاعدة البيانات**: `sigla_struttura`

رمز أبجدي رقمي يحدد نوع الهيكل. الاتفاقيات الشائعة:

| الرمز | المعنى | مثال |
|-------|--------|-------|
| MR | جدار | MR 1 |
| ST | هيكل | ST 5 |
| PV | رصف | PV 2 |
| FO | فرن | FO 1 |
| VA | حوض | VA 3 |
| TM | قبر | TM 10 |
| PT | بئر | PT 2 |
| CN | قناة | CN 1 |

### رقم الهيكل

**الحقل**: `numero_struttura`
**قاعدة البيانات**: `numero_struttura`

رقم تسلسلي للهيكل داخل الرمز.

**ملاحظات:**
- حقل رقمي
- يجب أن يكون فريداً لكل مجموعة موقع + رمز
- مقفل بعد الإنشاء

---

## حقول التصنيف

حقول التصنيف تحدد طبيعة الهيكل.

### فئة الهيكل

**الحقل**: `comboBox_categoria_struttura`
**قاعدة البيانات**: `categoria_struttura`

الفئة الوظيفية الكبرى للهيكل.

**القيم النموذجية:**
- سكني
- إنتاجي
- جنائزي
- ديني
- دفاعي
- مائي
- طرق
- حرفي

### نوع الهيكل

**الحقل**: `comboBox_tipologia_struttura`
**قاعدة البيانات**: `tipologia_struttura`

النوع المحدد داخل الفئة.

**أمثلة حسب الفئة:**

| الفئة | الأنواع |
|-------|--------|
| سكني | منزل، فيلا، قصر، كوخ |
| إنتاجي | فرن، طاحونة، معصرة |
| جنائزي | قبر حفري، قبر غرفة، تابوت |
| مائي | بئر، صهريج، قناة مياه، قناة |

### تعريف الهيكل

**الحقل**: `comboBox_definizione_struttura`
**قاعدة البيانات**: `definizione_struttura`

تعريف موجز ومحدد للعنصر الهيكلي.

**أمثلة:**
- جدار محيطي
- رصف من الآجر المحروق
- عتبة حجرية
- درج
- قاعدة عمود

---

## تبويب البيانات الوصفية

يحتوي التبويب الأول على الحقول النصية للوصف التفصيلي.

### الوصف

**الحقل**: `textEdit_descrizione_struttura`
**قاعدة البيانات**: `descrizione`

حقل نصي حر لوصف الهيكل المادي.

**المحتويات الموصى بها:**
- التقنية البنائية
- المواد المستخدمة
- حالة الحفظ
- الأبعاد العامة
- الاتجاه
- الخصائص المميزة

**مثال:**
```
جدار من البناء غير المنتظم منفذ بكتل من الحجر الجيري المحلي
بأبعاد متغيرة (15-30 سم). رابط من ملاط الجير
بلون أبيض. محفوظ بارتفاع أقصى 1.20 م.
عرض متوسط 50 سم. اتجاه شمال شرق - جنوب غرب. توجد آثار
ملاط على الجانب الداخلي.
```

### التفسير

**الحقل**: `textEdit_interpretazione_struttura`
**قاعدة البيانات**: `interpretazione`

التفسير الوظيفي والتاريخي للهيكل.

**المحتويات الموصى بها:**
- الوظيفة الأصلية المفترضة
- مراحل الاستخدام/إعادة الاستخدام
- المقارنات النموذجية
- الإطار الزمني
- العلاقات مع الهياكل الأخرى

**مثال:**
```
الجدار المحيطي الشمالي لمبنى سكني من العصر الروماني
الإمبراطوري. التقنية البنائية والمواد تشير إلى
تأريخ في القرن الثاني الميلادي. في مرحلة لاحقة (القرن 3-4)
تم تفكيك الجدار جزئياً ودمجه في
هيكل إنتاجي.
```

---

## تبويب التأريخ

يدير هذا التبويب الإطار الزمني للهيكل.

### الفترة والمرحلة الأولية

| الحقل | قاعدة البيانات | الوصف |
|-------|----------------|--------|
| الفترة الأولية | `periodo_iniziale` | فترة البناء/بداية الاستخدام |
| المرحلة الأولية | `fase_iniziale` | المرحلة داخل الفترة |

يتم ملء القيم تلقائياً بناءً على الفترات المحددة في بطاقة التأريخ للموقع المحدد.

### الفترة والمرحلة النهائية

| الحقل | قاعدة البيانات | الوصف |
|-------|----------------|--------|
| الفترة النهائية | `periodo_finale` | فترة الهجر/الإلغاء |
| المرحلة النهائية | `fase_finale` | المرحلة داخل الفترة |

### التأريخ الموسع

**الحقل**: `comboBox_datazione_estesa`
**قاعدة البيانات**: `datazione_estesa`

تأريخ حرفي محسوب تلقائياً أو مدخل يدوياً.

**الصيغ:**
- "القرن 1 ق.م - القرن 2 م"
- "100 ق.م - 200 م"
- "العصر الروماني الإمبراطوري"

---

## تبويب العلاقات

يدير هذا التبويب العلاقات بين الهياكل.

### جدول علاقات الهيكل

**الأداة**: `tableWidget_rapporti`
**قاعدة البيانات**: `rapporti_struttura`

يسجل العلاقات بين الهيكل الحالي والهياكل الأخرى.

**الأعمدة:**
| العمود | الوصف |
|--------|--------|
| نوع العلاقة | العلاقة الطبقية/الوظيفية |
| الموقع | موقع الهيكل المرتبط |
| الرمز | رمز الهيكل المرتبط |
| الرقم | رقم الهيكل المرتبط |

**أنواع العلاقات:**

| العلاقة | العكس | الوصف |
|---------|-------|--------|
| يرتبط بـ | يرتبط بـ | اتصال مادي متزامن |
| يغطي | مغطى بـ | علاقة تراكب |
| يقطع | مقطوع بـ | علاقة قطع |
| يملأ | ممتلئ بـ | علاقة ملء |
| يستند إلى | يستند إليه | علاقة استناد |
| يساوي | يساوي | نفس الهيكل باسم مختلف |

### إدارة الصفوف

| الزر | الوظيفة |
|------|---------|
| + | إضافة صف جديد |
| - | إزالة الصف المحدد |

---

## تبويب العناصر البنائية

يوثق هذا التبويب المواد والعناصر التي يتكون منها الهيكل.

### المواد المستخدمة

**الأداة**: `tableWidget_materiali_impiegati`
**قاعدة البيانات**: `materiali_impiegati`

قائمة المواد المستخدمة في البناء.

**أمثلة على المواد:**
- كتل حجر جيري
- آجر
- ملاط جيري
- حصى نهري
- قرميد
- رخام
- طفل

### العناصر الهيكلية

**الأداة**: `tableWidget_elementi_strutturali`
**قاعدة البيانات**: `elementi_strutturali`

قائمة العناصر البنائية مع الكميات.

**الأعمدة:**
| العمود | الوصف |
|--------|--------|
| نوع العنصر | نوع العنصر |
| الكمية | عدد العناصر |

**أمثلة على العناصر:**
| العنصر | الكمية |
|--------|--------|
| قاعدة عمود | 4 |
| تاج | 2 |
| عتبة | 1 |
| كتلة مربعة | 45 |

---

## تبويب القياسات

يسجل هذا التبويب أبعاد الهيكل.

### جدول القياسات

**الأداة**: `tableWidget_misurazioni`
**قاعدة البيانات**: `misure_struttura`

**الأعمدة:**
| العمود | الوصف |
|--------|--------|
| نوع القياس | نوع البعد |
| وحدة القياس | متر، سم، متر مربع، إلخ |
| القيمة | القيمة الرقمية |

### أنواع القياس الشائعة

| النوع | الوصف |
|-------|--------|
| الطول | البعد الأكبر |
| العرض | البعد الأصغر |
| الارتفاع المحفوظ | المرتفع المحفوظ |
| الارتفاع الأصلي | المرتفع المقدر الأصلي |
| العمق | للهياكل المدفونة |
| القطر | للهياكل الدائرية |
| السمك | للجدران والأرضيات |
| المساحة | المساحة بالمتر المربع |

### مثال على الإدخال

| نوع القياس | وحدة القياس | القيمة |
|------------|-------------|--------|
| الطول | م | 8.50 |
| العرض | سم | 55 |
| الارتفاع المحفوظ | م | 1.20 |
| المساحة | م² | 4.68 |

---

## تبويب الوسائط

إدارة الصور ومقاطع الفيديو والنماذج ثلاثية الأبعاد المرتبطة بالهيكل.

### الوظائف

**الأداة**: `iconListWidget`

يعرض الصور المصغرة للوسائط المرتبطة.

### السحب والإفلات

يمكن سحب الملفات مباشرة على البطاقة:

**الصيغ المدعومة:**
- الصور: JPG، JPEG، PNG، TIFF، TIF، BMP
- الفيديو: MP4، AVI، MOV، MKV، FLV
- ثلاثي الأبعاد: OBJ، STL، PLY، FBX، 3DS

### العرض

- **النقر المزدوج** على الصورة المصغرة: يفتح العارض
- للفيديو: يفتح مشغل الفيديو المدمج
- للنماذج ثلاثية الأبعاد: يفتح عارض PyVista ثلاثي الأبعاد

---

## تكامل GIS

### العرض على الخريطة

| الزر | الوظيفة |
|------|---------|
| Map Preview | تبديل المعاينة في تبويب الخريطة |
| Draw Structure | تمييز الهيكل على خريطة QGIS |
| Load to GIS | تحميل طبقة الهياكل |
| Load All | تحميل جميع هياكل الموقع |

### طبقة GIS

تستخدم البطاقة طبقة **pyarchinit_strutture** للعرض:
- الشكل الهندسي: مضلع أو مضلع متعدد
- السمات مرتبطة بحقول البطاقة

---

## التصدير والطباعة

### تصدير PDF

يفتح زر PDF لوحة بخيارات التصدير:

| الخيار | الوصف |
|--------|--------|
| قائمة الهياكل | قائمة مختصرة بالهياكل |
| بطاقات الهياكل | بطاقات كاملة مفصلة |
| طباعة | إنشاء PDF |
| تحويل إلى Word | تحويل PDF إلى صيغة Word |

### تحويل PDF إلى Word

وظيفة متقدمة لتحويل ملفات PDF المُنشأة إلى مستندات Word قابلة للتحرير:

1. اختر ملف PDF للتحويل
2. حدد نطاق الصفحات (اختياري)
3. انقر على "Convert"
4. يتم حفظ ملف Word في نفس المجلد

---

## سير العمل التشغيلي

### إنشاء هيكل جديد

1. **فتح البطاقة**
   - عبر القائمة أو شريط الأدوات

2. **سجل جديد**
   - انقر على زر "New Record"
   - تصبح الحقول التعريفية قابلة للتحرير

3. **البيانات التعريفية**
   ```
   الموقع: الفيلا الرومانية سيتفينستر
   الرمز: MR
   الرقم: 15
   ```

4. **التصنيف**
   ```
   الفئة: سكني
   النوع: جدار محيطي
   التعريف: جدار من البناء غير المنتظم
   ```

5. **البيانات الوصفية** (تبويب 1)
   ```
   الوصف: جدار منفذ من البناء غير المنتظم بكتل
   من الحجر الجيري المحلي...

   التفسير: الحد الشمالي للمنزل، المرحلة الأولى
   من المجمع السكني...
   ```

6. **التأريخ** (تبويب 2)
   ```
   الفترة الأولية: 1 - المرحلة: أ
   الفترة النهائية: 2 - المرحلة: ب
   التأريخ: القرن 1 ق.م - القرن 2 م
   ```

7. **العلاقات** (تبويب 3)
   ```
   يرتبط بـ: MR 16، MR 17
   مقطوع بـ: ST 5
   ```

8. **العناصر البنائية** (تبويب 4)
   ```
   المواد: كتل حجر جيري، ملاط جيري
   العناصر: كتل مربعة (52)، عتبة (1)
   ```

9. **القياسات** (تبويب 5)
   ```
   الطول: 12.50 م
   العرض: 0.55 م
   الارتفاع المحفوظ: 1.80 م
   ```

10. **الحفظ**
    - انقر على "Save"
    - تحقق من تأكيد الحفظ

### البحث عن الهياكل

1. انقر على "New Search"
2. أكمل حقل تصفية واحد أو أكثر:
   - الموقع
   - رمز الهيكل
   - الفئة
   - الفترة
3. انقر على "Search"
4. تنقل بين النتائج

### تعديل هيكل موجود

1. انتقل إلى السجل المطلوب
2. عدّل الحقول اللازمة
3. انقر على "Save"

---

## أفضل الممارسات

### التسمية

- استخدم رموزاً متسقة في كامل المشروع
- وثّق الاتفاقيات المستخدمة
- تجنب تكرار الترقيم

### الوصف

- كن منهجياً في الوصف
- اتبع مخططاً: التقنية > المواد > الأبعاد > الحالة
- افصل الوصف الموضوعي عن التفسير

### التأريخ

- اربط دائماً بالفترات المحددة في بطاقة التأريخ
- أشر إلى المرحلة الأولية والنهائية
- استخدم التأريخ الموسع للملخص

### العلاقات

- سجّل جميع العلاقات المهمة
- تحقق من تبادل العلاقات
- اربط بالوحدات الطبقية التي تتكون منها الهيكل

### الوسائط

- اربط صوراً تمثيلية
- أضف صور تفاصيل بنائية
- وثّق مراحل الحفر

---

## حل المشكلات

### المشكلة: الهيكل غير مرئي على الخريطة

**السبب**: شكل هندسي غير مرتبط أو طبقة غير محملة.

**الحل**:
1. تحقق من وجود طبقة `pyarchinit_strutture`
2. تحقق من وجود شكل هندسي مرتبط بالهيكل
3. تحقق من النظام المرجعي

### المشكلة: الفترات غير متاحة

**السبب**: فترات غير محددة للموقع.

**الحل**:
1. افتح بطاقة التأريخ
2. حدد الفترات للموقع الحالي
3. ارجع إلى بطاقة الهيكل

### المشكلة: خطأ حفظ "سجل موجود"

**السبب**: مجموعة الموقع + الرمز + الرقم موجودة بالفعل.

**الحل**:
1. تحقق من الترقيم الموجود
2. استخدم رقماً تسلسلياً متاحاً
3. تحقق من عدم وجود تكرارات

### المشكلة: الوسائط غير معروضة

**السبب**: مسار الصور غير صحيح.

**الحل**:
1. تحقق من المسار في التكوين
2. تحقق من وجود الملفات
3. أعد إنشاء الصور المصغرة إذا لزم الأمر

---

## العلاقات مع البطاقات الأخرى

| البطاقة | العلاقة |
|---------|---------|
| **بطاقة الموقع** | الموقع يحتوي على الهياكل |
| **بطاقة الوحدة الطبقية** | الوحدات الطبقية تتكون منها الهياكل |
| **بطاقة التأريخ** | توفر التسلسل الزمني |
| **بطاقة جرد المواد** | القطع الأثرية المرتبطة بالهياكل |
| **بطاقة القبر** | القبور كنوع خاص من الهياكل |

---

## المراجع

### قاعدة البيانات

- **الجدول**: `struttura_table`
- **فئة التعيين**: `STRUTTURA`
- **المعرف**: `id_struttura`

### الملفات المصدر

- **واجهة المستخدم**: `gui/ui/Struttura.ui`
- **المتحكم**: `tabs/Struttura.py`
- **تصدير PDF**: `modules/utility/pyarchinit_exp_Strutturasheet_pdf.py`

---

*آخر تحديث: يناير 2026*
*PyArchInit - نظام إدارة البيانات الأثرية*
